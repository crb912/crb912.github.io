---
published: true
title: è®¡ç®—æœºç¼–ç¨‹
layout: post
author: RuiBing
category: programming
top: true
---

ä½œä¸ºè‰ºæœ¯çš„è®¡ç®—æœºç¼–ç¨‹

* **ç›®å½•**
{:toc}

## ç¼–ç¨‹åŸåˆ™

### 1. é¦–è¦åŸåˆ™

- Rules with no enforcement are unmanageable for large code bases. æ²¡æœ‰å¼ºåˆ¶æ‰§è¡Œçš„è§„åˆ™ä¼šå¯¼è‡´å¤§å‹ä»£ç åº“æ— æ³•ç®¡ç†ã€‚
- SRP åŸåˆ™ï¼š single responsibility principle è®¾è®¡åŸåˆ™ã€‚æ¯”å¦‚å‡½æ•°è¦å°½å¯èƒ½ç®€å•ã€‚
- â€œäº‹ä¸è¿‡ä¸‰â€ï¼š å¦‚æœä½ éœ€è¦è¶…è¿‡3çº§çš„ç¼©è¿›ï¼Œé‚£ä¹ˆä½ å·²ç»æŠŠäº‹æƒ…æç ¸äº†ã€‚åº”è¯¥ä¿®å¤ä½ çš„ç¨‹åºã€‚ if you need more than 3 levels of indentation, you're screwed anyway, and should fix your program -- Linus Torvalds, [Linux kernel coding style](https://github.com/torvalds/linux/blob/master/Documentation/process/coding-style.rst) ç»æ£€æŸ¥ï¼Œå…³äºå¤šçº§æŒ‡é’ˆï¼ŒLinux Kernelæºä»£ç åªæœ‰20å¤šå¤„ **ä¸¤çº§æŒ‡é’ˆï¼Œæ²¡æœ‰ä»»ä½•çš„***ä¸‰çº§æŒ‡é’ˆã€‚

### 2. åŸºæœ¬ç±»å‹æˆ–å…³é”®å­—

- é¿å…è£¸çš„Unionã€‚å› ä¸ºUnionå¯ä»¥è§„é¿C++çš„ç±»å‹ç³»ç»Ÿï¼Œå¯¼è‡´ä¸æ˜“å¯Ÿè§‰çš„bugï¼Œå› æ­¤è¦é¿å…è¿™æ ·ä½¿ç”¨ã€‚æˆ‘ä»¬å¯ä»¥å•ç‹¬ç»´æŠ¤ä¸€ä¸ªtype fieldï¼Œä½¿å®ƒæˆä¸ºä¸€ä¸ªtagged unionï¼›æˆ–è€…ï¼Œä½¿ç”¨C++æ ‡å‡†åº“çš„variantã€‚
- å¦‚æœä½ çš„ä»£ç æœ‰å¤ªå¤šcastï¼Œè¯´æ˜ä½ å·²ç»æç ¸äº†ã€‚
- Use `dynamic_cast` where class hierarchy navigation is unavoidable; å½“ç±»å±‚æ¬¡æ¼«æ¸¸è¡Œä¸ºä¸å¯é¿å…æ—¶ï¼Œä½¿ç”¨åŠ¨æ€å¼ºåˆ¶è½¬æ¢ã€‚ å¦‚æœæ— æ³•è½¬æ¢å‘ç›®æ ‡ç±»æ—¶ï¼Œæƒ³è¦å®ƒæŠ¥é”™ï¼Œå°±ç”¨`dynamic_cast` ä½œç”¨äºå¼•ç”¨ç±»å‹ï¼›ä¸å¸Œæœ›æŠ¥é”™ï¼Œå°±ä½œç”¨äºæŒ‡é’ˆç±»å‹ã€‚
- Use `unique_ptr` or `shared_ptr` to avoid forgetting to delete objects created using new;
- newå‡ºæ¥çš„è£¸æŒ‡é’ˆï¼Œç›´æ¥ä»å‡½æ•°è¿”å›æ˜¯å¾ˆå±é™©çš„ã€‚æœ€å¥½ç”¨æ ‡å‡†åº“çš„`unique_ptr`,ä¾‹å¦‚`return unique_ptr<Shape>{new Circle{p,r}};`

### 2. å‡½æ•°

- å°½é‡ä¸è¦æŠŠboolå€¼ä½œä¸ºå‡½æ•°å‚æ•°ï¼Œè€Œåº”è¯¥æ˜¯ä½¿ç”¨æšä¸¾ç±»ã€‚å‚è§ï¼š[åƒä¸‡ä¸è¦æŠŠ BOOLè®¾è®¡æˆå‡½æ•°å‚æ•°](https://coolshell.cn/articles/5444.html)
- é¿å…ä½¿ç”¨å¸¦æœ‰å¤ªå¤šå†…ç½®ç±»å‹çš„å‡½æ•°ï¼Œå¦‚: draw_line(int, int, int, int);  // obscureã€‚è¿™ç§ä»£ç ä¸å®¹æ˜“ç†è§£å‚æ•°ç±»å‹çš„å«ä¹‰ã€‚

### 3. ç±»

C++: 

- friend classæœ‰åˆ©äºä»£ç çš„æ¨¡å—åŒ–ï¼Œå®ƒä¹Ÿå¯ç”¨äºç‰¹å®šçš„æˆå‘˜å‡½æ•°ã€‚å¦‚Nodeå’ŒLinkedList::search()
- ç±»çš„è®¾è®¡è¦åˆç†ï¼Œmake sense, èµ·ç è¦èƒ½ä»ç±»çš„åå­—å¯æ¨æµ‹å®ƒå¯èƒ½æä¾›çš„æ“ä½œã€‚
- èƒ½ç”¨constçš„åœ°æ–¹ä¸€å®šè¦ç”¨constï¼Œè¿™ä¼šæŠŠç¨‹åºå‘˜çš„æ„å›¾å‘Šè¯‰åˆ«äººã€‚
- ä½¿ç”¨æ ‡å‡†åº“ï¼Œè€Œä¸æ˜¯æ¨¡ä»¿æ ‡å‡†åº“ã€‚( mimics the standard library)
- explicitå…³é”®å­—å¯ä»¥é¿å…ä»£ç éšå¼è½¬æ¢ã€‚
- Use concrete classes to represent simple concepts;
- Prefer concerete classes over class hierarchies for performance-critical components; é«˜æ€§èƒ½ç»„ä»¶å°½å¯èƒ½ç”¨å…·ä½“ç±»
- Make a function a member only if it needs direct access to the representation of a class; ä»…å½“éœ€è¦ç›´æ¥è®¿é—®ç±»çš„è¡¨ç¤ºæ—¶ï¼Œæ‰ä½¿ç”¨æˆå‘˜å‡½æ•°ã€‚
- Declare a member function that does not modify the state of its object `const`;
- If a class is a container, give it an initializer-list constructor;
- An abstract class typically doesnâ€™t need a constructor;
- A class with a virtual function should have a virtual destructor;
- ç”±äºæŠ½è±¡ç±»çµæ´»çš„ç‰¹æ€§ï¼Œåœ¨æ´¾ç”Ÿç±»çš„destructorå‡½æ•°è¦ä¿è¯èµ„æºèƒ½è¢«é‡Šæ”¾ï¼Œè¿™å¤ªé‡è¦äº†ã€‚

#### 4.å…¶ä»–

---

## ä¼˜é›…çš„ä»£ç 

> Elegance is an attitude -- ç‘å£«æ‰‹è¡¨å“ç‰Œ æµªç´ï¼ˆLonginesï¼‰

### äºŒçº§æŒ‡é’ˆ

ç¤ºä¾‹ä»£ç ï¼šå•å‘é“¾è¡¨ä¸­åˆ é™¤ä¸€ä¸ªæŒ‡å®šçš„èŠ‚ç‚¹ï¼Œ Linusçš„åšæ³•ï¼š[ä»£ç ç‰‡æ®µ](https://external-preview.redd.it/_YjlXgAHs1jzF-w9V-FgfystXp4fIs5asEdG8KQAmco.png)
Linus çš„å“²å­¦æ˜¯ï¼š **è‰¯å¥½çš„ä»£ç åº”è¯¥èƒ½å¤Ÿå‘ç°å¹¶åˆ©ç”¨åº•å±‚æ¨¡å¼ï¼Œä»è€Œä½¿ç‰¹æ®Šæƒ…å†µæ¶ˆå¤±ï¼Œå˜ä¸ºæ™®é€šæƒ…å†µã€‚**

Linusè¿™ä¸ªä»£ç å¾ˆå¦™ã€‚æˆ‘çš„è¯¦ç»†è§£è¯»ï¼šåœ¨å†…å­˜ä¸­çš„ä¸€åˆ‡å®ä½“ï¼Œå˜é‡å’Œå¯¹è±¡ï¼Œ éƒ½æ˜¯æœ‰åœ°å€çš„ï¼Œå˜é‡å½“ç„¶ä¹ŸåŒ…æ‹¬æŒ‡é’ˆã€‚
æ‰€ä»¥æ¯ä¸ªæŒ‡é’ˆå®é™…ä¸Šæœ‰ä¸¤ä¸ªåœ°å€ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ‰€åšæŒ‡å‘çš„å¯¹è±¡çš„åœ°å€ï¼ˆå³æŒ‡é’ˆçš„å€¼ï¼‰ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯æŒ‡é’ˆè‡ªèº«çš„åœ°å€ï¼Œè€Œå®ƒè‡ªèº«çš„åœ°å€ç»å¸¸è¢«å¿½ç•¥å’Œé—å¿˜äº†ã€‚
å½“æˆ‘ä»¬æŠŠå¦ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘è¯¥æŒ‡é’ˆçš„è‡ªèº«åœ°å€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¼šå¾—åˆ°ä¸€ä¸ªäºŒçº§æŒ‡é’ˆï¼š æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆã€‚

æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦äºŒçº§æŒ‡é’ˆï¼Ÿ
- éœ€è¦ä¸€çº§æŒ‡é’ˆåœ¨å•æ­¥ç§»åŠ¨ï¼Œé€šè¿‡æ¯”è¾ƒä¸€çº§æŒ‡é’ˆçš„åœ°å€è€Œä¸æ˜¯æ¯”è¾ƒå®ƒæ‰€æŒ‡å‘çš„å€¼ã€‚
- éœ€è¦ä¿®æ”¹ä¸€çº§æŒ‡é’ˆæŒ‡å‘æ—¶ã€‚


 indirect æ˜¯ä¸€ä¸ªäºŒçº§æŒ‡é’ˆï¼Œå½“æˆ‘ä»¬å¯¹å®ƒè¿›è¡Œè§£å¼•ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¼šå¾—åˆ°ä¸€çº§æŒ‡é’ˆï¼Œå°±è¿™ä¹ˆç®€å•


```cpp
#include <iostream>

// å®šä¹‰é“¾è¡¨èŠ‚ç‚¹
struct Node {
    int data;
    Node* next;
    Node(int d) : data(d), next(nullptr) {}
};

// å…¨å±€å¤´æŒ‡é’ˆï¼Œæ–¹ä¾¿æ¼”ç¤º
Node* head = nullptr;

// è¾…åŠ©å‡½æ•°ï¼šå‘é“¾è¡¨æœ«å°¾æ·»åŠ æ•°æ®
void append(int data) {
    if (!head) {
        head = new Node(data);
        return;
    }
    Node* temp = head;
    while (temp->next) temp = temp->next;
    temp->next = new Node(data);
}

// è¾…åŠ©å‡½æ•°ï¼šæ‰“å°é“¾è¡¨
void print_list() {
    Node* temp = head;
    while (temp) {
        std::cout << temp->data << " -> ";
        temp = temp->next;
    }
    std::cout << "NULL" << std::endl;
}

// ä¼ ç»Ÿçš„å†™æ³• (Poor Taste) ---
void remove_list_entry_poor(Node* entry) {
    Node* prev = nullptr;
    Node* walk = head;

    // å¯»æ‰¾ç›®æ ‡èŠ‚ç‚¹å¹¶è®°å½•å‰é©±
    while (walk != entry) {
        prev = walk;
        walk = walk->next;
    }

    // å¿…é¡»å¤„ç†â€œåˆ é™¤çš„æ˜¯å¤´èŠ‚ç‚¹â€çš„ç‰¹æ®Šæƒ…å†µ
    if (!prev) {
        head = entry->next; // å¦‚æœæ²¡æœ‰å‰é©±ï¼Œè¯´æ˜åˆ é™¤çš„æ˜¯ç¬¬ä¸€ä¸ª
    } else {
        prev->next = entry->next; // å¦åˆ™è·³è¿‡å½“å‰èŠ‚ç‚¹
    }
    delete entry; // é‡Šæ”¾å†…å­˜
}

// Linus æ¨èçš„å†™æ³• (Good Taste) ---
void remove_list_entry_good(Node* entry) {
    // indirect æŒ‡å‘çš„æ˜¯â€œæŒ‡å‘å½“å‰èŠ‚ç‚¹çš„æŒ‡é’ˆâ€çš„åœ°å€
    Node** indirect = &head;

    // åªè¦å½“å‰æŒ‡å‘çš„èŠ‚ç‚¹ä¸æ˜¯ç›®æ ‡ï¼Œå°±ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªâ€œæŒ‡é’ˆçš„åœ°å€â€
    while ((*indirect) != entry) {
        indirect = &((*indirect)->next);  // å¤šåŠ äº†æ‹¬å·ï¼Œæ›´æ˜“è¯»
    }

    // æ ¸å¿ƒï¼šç›´æ¥ä¿®æ”¹é‚£ä¸ªæŒ‡å‘ entry çš„æŒ‡é’ˆï¼Œè®©å®ƒæŒ‡å‘ä¸‹ä¸€ä¸ª
    // æ— è®ºæ˜¯ head è¿˜æ˜¯æŸä¸ªèŠ‚ç‚¹çš„ nextï¼Œé€»è¾‘å®Œå…¨ä¸€è‡´
    *indirect = entry->next;
    delete entry; // é‡Šæ”¾å†…å­˜
}

int main() {
    // åˆå§‹åŒ–é“¾è¡¨: 10 -> 20 -> 30 -> 40 -> NULL
    append(10); append(20); append(30); append(40);
    std::cout << "åŸå§‹é“¾è¡¨: "; print_list();

    // æµ‹è¯• 1: ä½¿ç”¨â€œGood Tasteâ€æ–¹æ³•åˆ é™¤ä¸­é—´èŠ‚ç‚¹ 30
    Node* to_remove = head->next->next; // 30
    remove_list_entry_good(to_remove);
    std::cout << "åˆ é™¤ 30 å: "; print_list();

    // æµ‹è¯• 2: ä½¿ç”¨â€œGood Tasteâ€æ–¹æ³•åˆ é™¤å¤´èŠ‚ç‚¹ 10 (æ— ç‰¹æ®Šå¤„ç†ï¼)
    remove_list_entry_good(head);
    std::cout << "åˆ é™¤å¤´èŠ‚ç‚¹å: "; print_list();

    return 0;
}
```

C++ä¼˜å…ˆä½¿ç”¨**æŒ‡é’ˆçš„å¼•ç”¨**ï¼Œ è€Œä¸æ˜¯äºŒçº§æŒ‡é’ˆã€‚

```
// âŒ ä¸æ¨èï¼šäºŒçº§æŒ‡é’ˆ
void func(int** pp) {
    *pp = new int(42);
}

int* p;
func(&p);

// âœ… æ¨èï¼šå¼•ç”¨
void func(int*& p) {
    p = new int(42);
}

int* p;
func(p);  // æ›´ç®€æ´

```

### è‰¯å¥½çš„ç¼–è¯‘ä¹ æƒ¯

| ç¼–è¯‘å¼€å…³ | ä½œç”¨ | ç›®çš„ |
| :--- | :--- | :--- |
| `-fno-exceptions` | **ç¦ç”¨å¼‚å¸¸å¤„ç†** | æ¶ˆé™¤å †æ ˆå›æº¯å¸¦æ¥çš„æ—¶é—´ä¸ç¡®å®šæ€§ |
| `-fno-rtti` | **ç¦ç”¨è¿è¡Œæ—¶ç±»å‹è¯†åˆ«** | å‡å°‘äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°ï¼Œæ¶ˆé™¤è¿è¡Œæ—¶æŸ¥è¡¨å¼€é”€ |
| `-O3` / `-Ofast` | **æè‡´æ€§èƒ½ä¼˜åŒ–** | åˆ©ç”¨ç¼–è¯‘å™¨è¿›è¡Œå¾ªç¯å±•å¼€ã€æŒ‡ä»¤å¯¹é½ã€å‘é‡åŒ–ä¼˜åŒ– |
| `-Wall -Werror` | **è­¦å‘Šå³é”™è¯¯** | å¼ºåˆ¶æ‰§è¡Œæœ€é«˜æ ‡å‡†çš„ç¼–ç è§„èŒƒï¼Œæ¶ˆé™¤æ½œåœ¨éšæ‚£ |

## TODO-list

Bjarne Stroustrupè°ˆåˆ°ï¼Œâ€œC++æ˜¯ä¸€é—¨åºå¤§çš„è¯­è¨€ï¼Œè®¸å¤šäººè¿·å¤±åœ¨å®ƒçš„ç»†èŠ‚ä¸­ã€‚ç„¶è€Œï¼Œå†™å¥½C++ä½ åªéœ€è¦æŒæ¡ä¸€äº›åŸºæœ¬æŠ€å·§ï¼Œå…¶ä½™çš„ç¡®åªæ˜¯ç»†èŠ‚â€[BS12]ã€‚ä»–çš„è¿™ç•ªè¯ä¹Ÿä¸ºæˆ‘çš„C++å­¦ä¹ æŒ‡æ˜äº†æ–¹å‘ï¼š ä¸“æ³¨äºC++æ ¸å¿ƒçš„ç¼–ç¨‹æŠ€æœ¯ï¼Œå¿½ç•¥å„ç§ç¹æ‚çš„ç»†èŠ‚ã€‚ä¸æ˜¯è¯´ç»†èŠ‚å®Œå…¨ä¸é‡è¦ï¼Œè€Œæ˜¯ç»†èŠ‚å¯ä»¥åœ¨ç¼–ç¨‹æ—¶é€šè¿‡Googleå­¦ä¼šï¼Œä¸éœ€è¦æµªè´¹å¤§é‡çš„æ—¶é—´å»æŒæ¡ç»†ææœ«èŠ‚ã€‚æŠŠæ—¶é—´ç”¨åœ¨é‡è¦çš„äº‹æƒ…ä¸Šï¼Œæé«˜å­¦ä¹ çš„æ•ˆç‡ã€‚

å› æ­¤æˆ‘ä»BSçš„è®ºæ–‡ã€é‡‡è®¿ã€ä¹¦ç±é‡Œé¢æœé›†åˆ°äº†ä»–æåˆ°çš„ä¸€äº›C++æŠ€æœ¯ï¼Œè®°å½•åœ¨ä¸‹é¢ï¼Œå¹¶ä¸”ä¼šå¯¹æ¯æ¡ç»™å‡ºè§£é‡Šå’Œè¯´æ˜ã€‚å¸Œæœ›è¿™äº›å¯¹å…¶ä»–C++å­¦ä¹ ä¹Ÿèƒ½æœ‰äº›å¸®åŠ©ã€‚æ³¨æ„çš„æ˜¯ï¼ŒC++æ ‡å‡†åº“vector,map,set,listç­‰ä¸€ç³»åˆ—å®¹å™¨é‡Œé¢å·²ç»åº”ç”¨äº†è¿™äº›æŠ€æœ¯ï¼Œå¦‚æœä½ ä¸èƒ½ç†è§£ï¼Œå¯ä»¥å°è¯•é€šè¿‡é˜…è¯»æ ‡å‡†åº“çš„æºç æ¥å¾—åˆ°æ›´å¤šçš„é¢†æ‚Ÿã€‚

- classes for separating interfaces from implementations.
- constructors for establishing invariants, including acquiring resources,
- destructors for releasing resources,
- templates for parameterizing types and algorithms with types
- mapping of source language features to user-defined code specifying their meaning, e.g. [] for
- subscripting, the for-loop, new/delete for construction/destruction on the free store, and the {}
lists.
- use of half-open sequences, e.g. [begin():end()), to define for-loops and general algorithms.


## è§£é‡Šè¯´æ˜

"classes for separating interfaces from implementations"ã€‚ã€Œç±»ã€ç”¨äºä»å®ç°ä¸­åˆ†ç¦»æ¥å£ã€‚BSåœ¨å’ŒBill Vennersçš„è®¿è°ˆæåˆ°ï¼šâ€œè®¸å¤šC++ç¨‹åºå‘˜é™·å…¥å›°å¢ƒæ˜¯å› ä¸ºå¯¹ã€Œé¢å‘å¯¹è±¡ã€çš„æ»¥ç”¨ï¼Œä»–ä»¬è®¤ä¸º C++ åº”è¯¥æ˜¯ä¸€ç§éå¸¸é«˜çº§çš„è¯­è¨€ï¼Œå¹¶ä¸”ä¸€åˆ‡éƒ½åº”è¯¥æ˜¯é¢å‘å¯¹è±¡çš„ã€‚ä»–ä»¬è®¤ä¸ºä½ åº”è¯¥é€šè¿‡åˆ›å»ºä¸€ä¸ªç±»ä½œä¸ºå…·æœ‰å¤§é‡è™šå‡½æ•°çš„ç±»å±‚æ¬¡ç»“æ„ï¼Œç”¨è¿™ä¸€éƒ¨åˆ†æ¥å®Œæˆæ‰€æœ‰å·¥ä½œã€‚ä¾‹å¦‚ï¼Œè¿™ç§æ€æƒ³åæ˜ åœ¨åƒJavaè¿™æ ·çš„è¯­è¨€ä¸­ï¼Œä½†å¾ˆå¤šä¸œè¥¿ä¸é€‚åˆã€Œç±»ã€çš„å±‚æ¬¡ç»“æ„ã€‚æ•´æ•°(int)ä¸åº”è¯¥æ˜¯ç±»å±‚æ¬¡ç»“æ„çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä¸éœ€è¦ï¼ŒæŠŠå®ƒæ”¾è¿›ç±»é‡Œé¢è¦å¼€é”€çš„ï¼›è€Œä¸”å¾ˆéš¾ä¼˜é›…åœ°åšåˆ°è¿™ä¸€ç‚¹â€[BS03,Bill]ã€‚å°±æ˜¯è¯´ï¼š

1. å½“ä½ åªæ˜¯éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„æ—¶ï¼Œä¸€å®šä¸è¦å»æŠŠå®ƒè®¾è®¡æˆã€Œç±»ã€ã€‚å¦‚æœå®ƒçœŸçš„æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œé‚£å°±è®©å®ƒæˆä¸ºä¸€ä¸ªæ•°æ®ç»“æ„ã€‚
2. ä½ ä¸åº”è¯¥è®¡åˆ’ä¸€ä¸ªå±‚æ¬¡ç»“æ„ï¼Œå› ä¸ºä½ ä¸éœ€è¦ã€‚ä»…å½“ä½ ç¡®å®éœ€è¦ä¸€ä¸ªå±‚æ¬¡ç»“æ„æ—¶ï¼Œå†å»ä½¿ç”¨ç»§æ‰¿ã€‚
3. ä½ å¯ä»¥ç”¨å¤§é‡ç‹¬ç«‹çš„ã€Œå…·ä½“ç±»ã€æ¥ç¼–ç¨‹ï¼Œæ¯”å¦‚ä½ æƒ³è¦ä¸€ä¸ªå¤æ•°ï¼Œé‚£å°±å†™ä¸€ä¸ªå¤æ•°ã€‚ä¸éœ€è¦ç”¨å¸¦è™šå‡½æ•°çš„ã€ŒæŠ½è±¡ç±»ã€ã€‚

---

â€œconstructors for establishing invariants, including acquiring resourcesï¼› destructors for releasing resources,

è¿™å¥è¯åŒ…å«äº†ä¸¤ç§æŠ€æœ¯ï¼šä¸å˜å¼ï¼ŒRAIIã€‚

- å¯¹äºä¸å˜å¼ï¼ŒBSæåˆ°ï¼šâ€œæˆ‘çš„ç»éªŒæ³•åˆ™æ˜¯ï¼Œå½“ä¸”ä»…å½“æ‚¨å¯ä»¥è€ƒè™‘å»ºç«‹ç±»çš„ä¸å˜é‡æ—¶ï¼Œæ‚¨æ‰åº”è¯¥æ‹¥æœ‰ä¸€ä¸ªå…·æœ‰æ¥å£å’Œéšè—è¡¨ç¤ºçš„çœŸå®ç±»â€[BS03,Bill]ã€‚ä¸å˜å¼ç”¨æ¥ä¿è¯å¯¹è±¡æœ‰æ•ˆã€‚æ¯”å¦‚ï¼Œä½ æœ‰ä¸ªTemperature(æ¸©åº¦)ç±»ï¼Œå®ƒæ¥å—è¾“å…¥çš„æµ®ç‚¹æ•°ç”¨æ¥åˆå§‹åŒ–ï¼Œä½†æ˜¯ä½ å§‹ç»ˆåº”è¯¥åœ¨æ„é€ å‡½æ•°é‡Œé¢æ£€æµ‹æ¸©åº¦æ˜¯å¦æ˜¯å¤§äºç»å¯¹é›¶åº¦(-273.15â„ƒ)ï¼Œå› ä¸ºåˆå§‹åŒ–çš„æ•°å­—å°äºç»å¯¹é›¶åº¦æ—¶ï¼Œé‚£å®ƒå¿…å®šæ˜¯é”™è¯¯å€¼ï¼Œå¯¹è±¡æ˜¯æ— æ•ˆçš„ã€‚è™½ç„¶ä½ å®Œå…¨ä¹Ÿå¯ä»¥ç”¨æˆå‘˜å‡½æ•°å®ç°è¿™ä¸€æ£€æµ‹ï¼Œä½†ä¸åº”è¯¥é‚£æ ·åšï¼Œä½ åº”è¯¥æ€»æ˜¯åœ¨æ„é€ å‡½æ•°å»ºè®®ä¸å˜å¼ã€‚è¿™æ ·å°±å¯ä»¥å®Œå…¨é¿å…å®ä¾‹äº†ä¸€ä¸ªæ— æ•ˆçš„å¯¹è±¡ã€‚
- RAIIï¼Œèµ„æºç”³è¯·å³åˆå§‹åŒ–ã€‚å°±æ˜¯è¯´ï¼Œå½“ä½ å¼€å§‹ç”³è¯·èµ„æºæ—¶ï¼Œè¡¨æ˜ä½ æ­£åœ¨åˆå§‹åŒ–ï¼›åè¿‡æ¥ï¼Œå½“ä½ åœ¨é”€æ¯å¯¹è±¡æ—¶ï¼Œä½ åº”è¯¥é‡Šæ”¾èµ„æºã€‚RAIIï¼Œå®ƒæŠŠå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¸èµ„æºç”³è¯·/é‡Šæ”¾çš„æ—¶é—´ç‚¹è”ç³»åˆ°ä¸€èµ·ã€‚å®ƒçœ‹èµ·æ¥ä¸èƒ½ç§°ä¸ºä¸€ä¸ªæŠ€æœ¯ï¼Œæ— éæ˜¯åœ¨æ„é€ å‡½æ•°ä¸­ç”³è¯·èµ„æºï¼Œåœ¨ææ„å‡½æ•°ä¸­é‡Šæ”¾èµ„æºã€‚ä½†å¦‚æœä¸å®ƒå•ç‹¬ç”¨ä¸€ä¸ªæœ¯è¯­å»â€œæ˜¾å¼çš„â€æé†’ç¨‹åºå‘˜ä»¬æœ‰è¿™ä¹ˆä¸€ä¸ªæŠ€æœ¯å­˜åœ¨ï¼Œé‚£ä¹ˆå¾ˆå¤šç¨‹åºå‘˜å°±å¯èƒ½ä¼šåœ¨å„ç§æˆå‘˜å‡½æ•°ä¸­ç”³è¯·èµ„æºï¼Œå› æ­¤ä¼šé€ æˆèµ„æºç®¡ç†çš„ç¾éš¾ã€‚RAIIæé†’æ¯ä¸ªC++ç¨‹åºå‘˜ï¼Œä½ æœ€å¥½ä¸è¦åœ¨éæ„é€ å‡½æ•°ä¸­newä¸€ä¸ªèµ„æºï¼Œåº”è¯¥æ€»æ˜¯åœ¨æ„é€ å‡½æ•°ç”³è¯·ï¼Œåœ¨ææ„å‡½æ•°é‡Šæ”¾ã€‚å¦‚æœä¸€ä¸ªæ€»æ˜¯èƒ½åšåˆ°RAIIï¼Œé‚£ä»–åŸºæœ¬ä¸å¯èƒ½ä¼šå†™å‡ºèµ„æºæ³„æ¼çš„ä»£ç ã€‚ï¼ˆæ³¨æ„ï¼šã€Œèµ„æºã€ä¸€è¯ä¸ä»…ä»…æ˜¯æŒ‡free storeè‡ªç”±å­˜å‚¨è¿™ä¸€å†…å­˜èµ„æºï¼Œä¹ŸåŒ…æ‹¬äº†æ–‡ä»¶æè¿°ç¬¦ã€ä¿¡å·é‡ã€æ•°æ®åº“é”ç­‰èµ„æºï¼Œä¸€å®šè¦é¿å…è¿™äº›èµ„æºçš„æ³„æ¼ï¼‰ã€‚


[BS12] B. Stroustrup: Foundations of C++, Texas A&M University.
[BS03,Bill] A Conversation with Bjarne Stroustrup, https://www.artima.com/intv/bjarne.html


---

## è®¡ç®—æœºåŸºç¡€

### Cache misså»¶è¿Ÿçš„æ—¶é’Ÿå‘¨æœŸ

å¦‚æœ **1 CPU å‘¨æœŸ = 1 ç§’**ï¼ˆåŸºäº 3 GHz CPUï¼Œ1 cycle â‰ˆ 0.33 nsï¼‰ï¼Œé‚£ä¹ˆå„ç§æ“ä½œçš„å»¶è¿Ÿç›¸å½“äºï¼š

| æ“ä½œ | å®é™…å»¶è¿Ÿ | å®é™…æ—¶é—´ | ç±»æ¯”æ—¶é—´ | ç”Ÿæ´»åœºæ™¯ |
|------|---------|---------|---------|---------|
| **CPU å¯„å­˜å™¨** | 0 cycles | 0 ns | **0 ç§’** | è„‘ä¸­å›å¿† |
| **L1 ç¼“å­˜å‘½ä¸­** | 4 cycles | 1.3 ns | **4 ç§’** | æ‹¿èµ·æ¡Œä¸Šçš„ç¬” |
| **L2 ç¼“å­˜å‘½ä¸­** | 12 cycles | 4 ns | **12 ç§’** | ä»ä¹¦æ¶å–ä¹¦ |
| **L3 ç¼“å­˜å‘½ä¸­** | 42 cycles | 14 ns | **42 ç§’** | å»éš”å£æˆ¿é—´ |
| **ä¸»å†…å­˜è®¿é—®** | 200 cycles | 67 ns | **3.3 åˆ†é’Ÿ** | å¼€è½¦å»è¶…å¸‚ |
| **åˆ†æ”¯é¢„æµ‹å¤±è´¥** | 20 cycles | 6.7 ns | **20 ç§’** | èµ°é”™è·¯è¿”å› |
| **äº’æ–¥é”åŠ é”/è§£é”** | 100 cycles | 33 ns | **1.7 åˆ†é’Ÿ** | æ’é˜Ÿç­‰ç”µæ¢¯ |
| **ç³»ç»Ÿè°ƒç”¨** | 1,500 cycles | 500 ns | **25 åˆ†é’Ÿ** | å¼€è½¦ç©¿è¶ŠåŸå¸‚ |
| **ä¸Šä¸‹æ–‡åˆ‡æ¢** | 10,000 cycles | 3 Î¼s | **2.8 å°æ—¶** | åç«è½¦å»å¦ä¸€ä¸ªåŸå¸‚ |
| **SSD éšæœºè¯»å–** | 50,000 cycles | 16 Î¼s | **14 å°æ—¶** | åé£æœºè·¨å›½æ—…è¡Œ |
| **SSD é¡ºåºè¯»å– 1MB** | 300,000 cycles | 100 Î¼s | **3.5 å¤©** | ä¸€å‘¨çŸ­é€”æ—…è¡Œ |
| **HDD å¯»é“æ—¶é—´** | 10,000,000 cycles | 3.3 ms | **4 ä¸ªæœˆ** | æ€€å­•å¤§åŠç¨‹ |
| **ç½‘ç»œï¼šåŒæ•°æ®ä¸­å¿ƒ** | 1,500,000 cycles | 500 Î¼s | **17 å¤©** | ä¸€ä¸ªæœˆå‡æœŸ |
| **ç½‘ç»œï¼šè·¨å¤§é™†** | 450,000,000 cycles | 150 ms | **14 å¹´** | å­©å­ä»å‡ºç”Ÿåˆ°åˆä¸­ |
| **ç½‘ç»œï¼šåœ°çƒå¦ä¸€ç«¯** | 900,000,000 cycles | 300 ms | **28 å¹´** | ä¸€ä»£äººçš„æ—¶é—´ |

**æ•°é‡çº§å¯¹æ¯”**ï¼š
- ğŸŸ¢ ç¼“å­˜è®¿é—®ï¼šç§’çº§ï¼ˆå¯æ¥å—ï¼‰
- ğŸŸ¡ å†…å­˜è®¿é—®ï¼šåˆ†é’Ÿçº§ï¼ˆå¼€å§‹å˜æ…¢ï¼‰
- ğŸŸ  ç£ç›˜è®¿é—®ï¼šå¤©/æœˆçº§ï¼ˆå¾ˆæ…¢ï¼‰
- ğŸ”´ ç½‘ç»œè®¿é—®ï¼šå¹´çº§ï¼ˆææ…¢ï¼‰

> **æ ¸å¿ƒå¯ç¤º**ï¼šç¨‹åºæ€§èƒ½ä¼˜åŒ–çš„æœ¬è´¨æ˜¯å‡å°‘"ç­‰å¾…æ—¶é—´"ï¼Œå°±åƒäººç”Ÿä¸­å°½é‡å‡å°‘æ— æ•ˆç­‰å¾…ä¸€æ ·ã€‚

---

### ä¸­æ–­

1.è¿™ä¸ª[MCU: Interrupts and Timers](https://students.iitk.ac.in/eclub/assets/lectures/techkriti12/timers_and_interrupts.pdf)å¹»ç¯ç‰‡ï¼Œå¼€å¤´ä»¥æ²¡æœ‰ä¸­æ–­çš„ç¯æ³¡åˆ‡æ¢çš„ç¨‹åºä¸ºä¾‹ï¼Œå½“é’ˆè„šçš„ç”µå¹³æ”¹å˜æ—¶æ— æ³•ç¡®å®šç¨‹åºåˆšå¥½èƒ½æ•æ‰åˆ°è¿™ä¸€å˜åŒ–ã€‚å› ä¸ºé»˜è®¤çš„å‰ææ˜¯è¦ä»æ—¶é—´ä¸Šä¿è¯äº‹ä»¶å‘ç”Ÿçš„å…ˆåé¡ºåºï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªâ€œé’Ÿè¡¨â€ä¿è¯åŒæ­¥çš„é¡ºåºï¼Œè¿™å°±æ˜¯ä¸­æ–­å­˜åœ¨çš„æœ¬è´¨æ„ä¹‰ã€‚ä½œè€…è®²åˆ°ä¸­æ–­çš„è‡ªå¢**timerå¯„å­˜å™¨**ï¼Œå®ƒæ˜¯ä¸­æ–­è®¾è®¡çš„æ ¸å¿ƒã€‚ä»0å¢é•¿åˆ°æœ€å¤§å†å›åˆ°0ï¼Œè¿‡ç¨‹ç‹¬ç«‹äºCPUã€‚Timeräº§ç”Ÿä¸¤ç§ä¸­æ–­ï¼š`OVERFLOW interrupt`å’Œ`COMPARE MATCH interrupt`ï¼Œåè€…ä¾èµ–æ˜¯ä¸€ä¸ªOCR(è¾“å‡ºæ¯”è¾ƒå¯„å­˜å™¨)ï¼Œå› ä¸ºå®ƒæ˜¯å¯ç¼–ç¨‹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ“ä½œç³»ç»Ÿå¯ä»¥æŒ‡å®šä¸­æ–­é¢‘ç‡ã€‚å½“OCRå’Œtimeræ•°å€¼ç›¸ç­‰ï¼Œåˆ™è§¦å‘ä¸­æ–­ã€‚

![interrupt](https://github.com/crb912/crb912.github.io/blob/master/my_private/image/20220104interrupt.png?raw=true)

Timerä¸‰ç§æ¨¡å¼ï¼ša.æ­£å¸¸æ¨¡å¼ï¼Œä¿æŒè‡ªå¢ã€‚b.**CTC** (Clear Timer on Compare) Mode æ¯”è¾ƒæˆåŠŸæ—¶ç½®é›¶ c.**PWM**(è„‰å®½è°ƒåˆ¶)æ¨¡å¼ï¼Œåˆ©ç”¨æ¯”è¾ƒåŒ¹é…æŠŠæ•´ä¸ªTimerå¯„å­˜å™¨çš„æ•°æ®åŒºé—´â€œåˆ‡åˆ†â€æˆä¸¤æ®µï¼Œåˆ†åˆ«ä½¿ç”¨ä¸åŒç”µå¹³ï¼Œç”±æ­¤äº§ç”Ÿä¸åŒå®½åº¦è„‰å†²ã€‚è¿™ä¸€æ¨¡å¼åœ¨åµŒå…¥å¼ä¸Šå¯èƒ½å¾—åˆ°åº”ç”¨ã€‚

![PWM](https://github.com/crb912/crb912.github.io/blob/master/my_private/image/20220104interrupt_PWM.png?raw=true)

[CodeVisionAVR](http://www.hpinfotech.ro/index.html)å¯ç»™AVRæ¶æ„å•ç‰‡æœºèŠ¯ç‰‡ç¼–ç¨‹ã€‚

2.è¿™ç¯‡[ A Problem of Program Execution Time Measurement](https://ruibing.org/essay/2021/02/01/Papers-Comment.html#20220103MeasureAppExeTime)è®ºæ–‡è®¨è®ºäº†ç¨‹åºæ‰§è¡Œæ—¶é—´æµ‹é‡çš„è¯¯å·®ï¼Œè¯¯å·®çš„æ ¹æºæ˜¯å› ä¸ºæ— æ³•ä¿è¯æµ‹é‡çš„å¼€å¤´å’Œç»“æŸæ—¶é—´ç‚¹æ°å¥½å°±æ˜¯ä¸­æ–­çš„å‘ç”Ÿæ—¶é—´ã€‚åœ¨å®Œç¾ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œé™¤éä¸­æ–­æ˜¯è¿ç»­çš„ï¼Œè€Œéé—´æ¥æ€§çš„ï¼Œå®ƒæ‰èƒ½å¯èƒ½æ°å¦‚å…¶åˆ†çš„æ•æ‰åˆ°äº‹ä»¶çš„å¼€å¤´å’Œç»“å°¾ã€‚ä½†è¿™å°±å¿…ç„¶ä¼šå¯¼è‡´ç¨‹åºæ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥è¿™ç§è¿ç»­ä¸­æ–­çš„ç†æƒ³ä¸åº”å½“æˆç«‹çš„ã€‚å¦ä¸€æ–¹é¢ï¼Œè‡ªç„¶ç•Œä¸å­˜åœ¨çœŸæ­£å®Œç¾è¿ç»­çš„ä¸œè¥¿ï¼Œå³ä¾¿æ˜¯å…‰ä¹Ÿæ˜¯ç”±ç²’å­æ„æˆçš„ï¼Œè¿™ä»å“²å­¦çš„è§’åº¦å¦å®šäº†è¿ç»­ä¸­æ–­å­˜åœ¨çš„å¯èƒ½æ€§ã€‚

3.è¿™ç¯‡è®ºæ–‡[Choosing the Right Timer Interrupt Frequency on Linux](https://ruibing.org/essay/2021/02/01/Papers-Comment.html#20220103RightIF)åˆ™æµ‹è¯•äº†å„ç§ä¸åŒçš„ä¸­æ–­é¢‘ç‡ï¼Œä»¥å¸®åŠ©æˆ‘ä»¬é€‰æ‹©æœ€åˆé€‚çš„é¢‘ç‡ã€‚æˆ‘åœ¨è¿™ç¯‡[æ–‡ç« ](https://ruibing.org/essay/2021/02/01/Concise-Sci-Tech-Commnets.html#20211007WinIF)åˆ†åˆ«æäº†Windowså’ŒLinux é»˜è®¤çš„ä¸­æ–­é¢‘ç‡æ•°å€¼ã€‚

4.CS:APP BetaèŠ‚é€‰ç« èŠ‚ *Measuring Program Execution Time*ï¼Œç›—ç‰ˆBetaä¸Šå†…å®¹ï¼Œä¸çŸ¥ä½œè€…ä¸ºä»€ä¹ˆåœ¨æ­£ç‰ˆä¸Šåˆ äº†å¾ˆæ£’çš„è¿™ä¸€ç« èŠ‚ã€‚**CPUåœ¨å¾®è§‚ä¸Šä»¥nsä½œä¸ºäº‹ä»¶çš„æ—¶é—´å°ºåº¦ï¼Œè€ŒOSåœ¨å®è§‚ä¸Šä»¥msä½œä¸ºæ—¶é—´å°ºåº¦ã€‚å‰è€…åŸºäºCPUçš„æ—¶é’Ÿè‡ªå¢ï¼Œåè€…åŸºäºç‹¬ç«‹çš„timer**. å› æ­¤æ˜¯ä¸¤ç§ä¸åŒçš„æµ‹é‡æ–¹æ³•ã€‚ç”±äºä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å¤§ï¼Œå› æ­¤éœ€æ¶ˆé™¤ã€‚

ä¸€äº›äº‹ä»¶çš„æ—¶é—´ï¼šè§†é¢‘æ’­æ”¾ï¼Œæ˜¾å¡çš„åˆ·æ–°æ¯33msï¼›ç£ç›˜å¯åŠ¨ä¼ è¾“å¤§çº¦10msï¼›OSçš„ä»»åŠ¡åˆ‡æ¢æ˜¯5-20ms;**æ“ä½œç³»ç»Ÿç®¡ç†äº‹ä»¶åœ¨5åƒ-2ä¸‡çš„æ—¶é’Ÿå‘¨æœŸï¼Œè¿™ä¸ªèŒƒå›´çš„æ—¶é—´å°ºåº¦æ˜¯å¾®ç§’(Î¼s)**ã€‚

**æ€»ç»“**ï¼š

1.å¶ç„¶ä¸å¿…ç„¶çš„ç»“åˆ  

- ä¸­æ–­ä¿¡å·å¯ä»¥æ˜¯ç¡¬ä»¶å¶ç„¶æ€§äº‹ä»¶å‘å‡ºçš„ï¼Œæ¯”å¦‚ï¼škeystrokes, disk operations, newwork activityï¼Œé¼ æ ‡ç§»åŠ¨ï¼Œè¿™äº›è®¾å¤‡å‘ä¸­æ–­æ§åˆ¶å™¨Timerå‘é€[IRQä¸­æ–­è¯·æ±‚](https://en.wikipedia.org/wiki/Interrupt_request_(PC_architecture))ï¼Œæ¥ç€OSè´Ÿè´£åˆ‡æ¢å’Œè°ƒåº¦ç›¸åº”çš„è¿›ç¨‹ï¼Œè®©ç”¨æˆ·æœŸæœ›ä¼˜å…ˆçš„è¿›ç¨‹å®Œæˆä¸­æ–­çš„å¤„ç†ã€‚
- ä¸­æ–­ä¿¡å·ä¹Ÿå¯ä»¥ç”±å¿…ç„¶æ€§äº‹ä»¶äº§ç”Ÿï¼Œå› ä¸ºå•æœ‰å¶ç„¶æ€§æ˜¯ä¸å¤Ÿçš„ï¼Œä»éœ€è¦ä¸€ä¸ªå›ºå®šå‘¨æœŸçš„æ—¶é’Ÿæ¥äº§ç”Ÿä¸­æ–­ã€‚å®ƒè®©OSå¯ä»¥â€œå…¬å¹³â€è°ƒåº¦å¤šä¸ªè¿›ç¨‹ã€‚

2.ç¡¬ä»¶å’Œè½¯ä»¶çš„ç»Ÿä¸€

æ‰€æœ‰æ•™æåœ¨è®²ä¸­æ–­æ—¶ï¼Œå‡ ä¹éƒ½æ²¡æœ‰å°†ç¡¬ä»¶å’Œè½¯ä»¶ä¸¤è€…å¾ˆå¥½çš„ç»“åˆåˆ°ä¸€èµ·ã€‚åµŒå…¥å¼å¼€å‘åˆ™è¿‡åˆ†å…³å¿ƒå…¶ç”µæ°”ç‰¹æ€§ï¼Œè½¯ä»¶å¼€å‘åˆ™åˆé›†ä¸­åœ¨å…¶è½¯ä»¶çš„æŠ½è±¡å±‚ã€‚ä¸­æ–­ï¼Œå®ƒæ—¢å·¥ä½œåœ¨ç¡¬ä»¶å±‚ï¼Œåˆå·¥ä½œåœ¨è½¯ä»¶å±‚ã€‚å¦‚æœåªæ˜¯å…³æ³¨å…¶ä¸­ä¸€ä¸ªç‰¹æ€§ï¼Œå¿…å®šæ— æ³•çª¥è§å¥¹é¢çº±ä¹‹ä¸‹çš„çœŸå®åŸè²Œã€‚å› æ­¤æƒ³è¦äº†è§£ä¸­æ–­æ—¶ï¼Œå°±å¿…é¡»è¦ä»è¿™ä¸¤ä¸ªæ–¹é¢åŒæ—¶æŠŠæ¡ã€‚ä»ç¡¬ä»¶æ–¹é¢ï¼Œè¦çŸ¥é“è¿™äº›ç¡¬ä»¶å­˜åœ¨ï¼Œè¿™é‡Œ[Timer Interrupt Sources](https://wiki.osdev.org/Timer_Interrupt_Sources)æåˆ°äº†å„ç±»çš„æ—¶é’Ÿï¼ŒåŒ…æ‹¬ä¸­æ–­æ—¶é’ŸPITã€HPETç­‰ï¼Œå…¶ä¸­APICå’ŒTSCæ˜¯æ¯ä¸ªCPUéƒ½æœ‰ä¸€ä¸ªï¼Œæ¯ä¸ªæ—¶é’Ÿåˆæœ‰ä¸åŒçš„åŒºåˆ«ï¼ˆFixed Frequency IRQï¼ŒIRQ on terminal countï¼‰ã€‚ä»è½¯ä»¶æ–¹é¢ï¼Œç†è§£ä¸­æ–­å¸¦æ¥çš„å¥½å¤„ã€‚å°±å®Œæˆäº†å®ƒçš„å­¦ä¹ ã€‚

---
### ç¡¬å®æ—¶ vs è½¯å®æ—¶

ç¡¬å®æ—¶ï¼ˆHard Real-Timeï¼‰å’Œè½¯å®æ—¶ï¼ˆSoft Real-Timeï¼‰çš„åŒºåˆ«ä¸åœ¨äºé€Ÿåº¦çš„â€œå¿«æ…¢â€ï¼Œè€Œåœ¨äºå¯¹ç¡®å®šæ€§ï¼ˆDeterminismï¼‰å’Œåæœï¼ˆConsequencesï¼‰**çš„è¦æ±‚ã€‚

1. å¯¹â€œæˆªæ­¢æ—¶é—´â€ï¼ˆDeadlineï¼‰çš„å®¹å¿åº¦

è¿™æ˜¯ä¸¤è€…æœ€æœ¬è´¨çš„åŒºåˆ«ã€‚åœ¨å®æ—¶ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªä»»åŠ¡ä¸ä»…è¦è®¡ç®—æ­£ç¡®ï¼Œè¿˜è¦åœ¨è§„å®šæ—¶é—´å†…å®Œæˆã€‚

- ç¡¬å®æ—¶ï¼šæˆªæ­¢æ—¶é—´æ˜¯ç»å¯¹çš„ã€‚å¦‚æœä»»åŠ¡æ™šäº†ä¸€æ¯«ç§’ï¼Œå°±è¢«è§†ä¸ºç³»ç»Ÿæ•…éšœï¼ˆSystem Failureï¼‰ã€‚å°±åƒåœ¨ Stroustrupè®ºæ–‡ [Abstraction and the C++ machine model](https://www.stroustrup.com/abstraction-and-machine.pdf) ä¸­çœ‹åˆ°çš„èˆ¹èˆ¶å¼•æ“æ§åˆ¶ï¼Œå¦‚æœå–·æ²¹æŒ‡ä»¤æ™šäº†ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç‰©ç†æŸåã€‚
- è½¯å®æ—¶ï¼šæˆªæ­¢æ—¶é—´æ˜¯æœŸæœ›çš„ã€‚å¦‚æœä»»åŠ¡å¶å°”æ™šäº†ä¸€ç‚¹ï¼Œç³»ç»Ÿæ€§èƒ½ä¼šä¸‹é™ï¼ˆæ¯”å¦‚è§†é¢‘æ‰å¸§ï¼‰ï¼Œä½†ç³»ç»Ÿä¾ç„¶å¯ä»¥ç»§ç»­è¿è¡Œï¼Œä¸ä¼šå‘ç”Ÿç¾éš¾ã€‚

2. å…¸å‹åº”ç”¨åœºæ™¯å¯¹æ¯”

| ç‰¹æ€§ | **ç¡¬å®æ—¶ (Hard Real-Time)** | **è½¯å®æ—¶ (Soft Real-Time)** |
| :--- | :--- | :--- |
| **è¿çº¦åæœ** | **ç¾éš¾æ€§**ï¼ˆäººå‘˜ä¼¤äº¡ã€æ˜‚è´µè®¾å¤‡æŸåï¼‰ | **ä½“éªŒä¸‹é™**ï¼ˆä¸çˆ½ã€å¡é¡¿ã€é‡è¯•ï¼‰ |
| **å…¸å‹ä¾‹å­** | æ±½è½¦å®‰å…¨æ°”å›Šã€èµ·æå™¨ã€**é£æ§ç³»ç»Ÿ** | è§†é¢‘ä¼šè®®ã€åœ¨çº¿æ¸¸æˆã€è‡ªåŠ¨è´©å–æœº |
| **æˆåŠŸæ ‡å‡†** | **100% ç¡®å®šæ€§**å®Œæˆï¼ˆé›¶å®¹å¿ï¼‰ | ç»Ÿè®¡å­¦ä¸Šçš„**å¹³å‡å®Œæˆæ—¶é—´** |
| **OS è°ƒåº¦** | **æŠ¢å å¼**ã€ä¼˜å…ˆçº§ä¸¥æ ¼å›ºå®š | å°½åŠ›è€Œä¸º (**Best Effort**) |
| **æ—¶é—´çº¦æŸ** | æˆªæ­¢æ—¶é—´ï¼ˆDeadlineï¼‰æ˜¯**ç¡¬æŒ‡æ ‡** | æˆªæ­¢æ—¶é—´æ˜¯**ç›®æ ‡**ï¼Œå…è®¸å¶å°”åç¦» |

3. æŠ€æœ¯å®ç°ä¸Šçš„æŒ‘æˆ˜

ç¡¬å®æ—¶çš„â€œç¦åŒºâ€ã€‚åœ¨ç¡¬å®æ—¶ç¼–ç¨‹ä¸­ï¼Œä½ å¿…é¡»é¿å¼€æ‰€æœ‰æ‰§è¡Œæ—¶é—´ä¸ç¡®å®šçš„æ“ä½œï¼š

- åŠ¨æ€å†…å­˜åˆ†é…ï¼šnew å’Œ delete å¯èƒ½ä¼šè§¦å‘å†…å­˜ç¢ç‰‡æ•´ç†ï¼Œè€—æ—¶æ— æ³•é¢„æµ‹ã€‚
- å¼‚å¸¸å¤„ç† (throw/catch)ï¼šæ­£å¦‚ä½ åˆšæ‰å¼•ç”¨çš„ï¼Œå †æ ˆå›æº¯çš„æ—¶é—´å–å†³äºè°ƒç”¨æ·±åº¦ï¼Œéš¾ä»¥é¢„æµ‹ã€‚
- åƒåœ¾å›æ”¶ (GC)ï¼šåƒ Java/Python è¿™ç§æœ‰è‡ªåŠ¨ GC çš„è¯­è¨€å¾ˆéš¾ç”¨äºç¡¬å®æ—¶ï¼Œå› ä¸ºä½ ä¸çŸ¥é“ GC ä»€ä¹ˆæ—¶å€™ä¼šçªç„¶â€œåœé¡¿ä¸–ç•Œâ€ã€‚


è½¯å®æ—¶çš„â€œå®½å®¹â€ï¼šåœ¨è½¯å®æ—¶ç³»ç»Ÿä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ std::vector çš„åŠ¨æ€æ‰©å®¹ï¼Œä¹Ÿå¯ä»¥å¶å°”å¤„ç†å¼‚å¸¸ã€‚è™½ç„¶è¿™äº›ä¼šå¸¦æ¥æ³¢åŠ¨ï¼Œä½†åªè¦å¹³å‡å»¶è¿Ÿï¼ˆLatencyï¼‰è¶³å¤Ÿä½ï¼Œç”¨æˆ·å°±ä¸ä¼šå¯Ÿè§‰ã€‚

4. ä¸ºä»€ä¹ˆ Stroustrup å¯¹â€œç¡®å®šæ€§â€ï¼ˆPredictability å¯é¢„æµ‹æ€§ï¼‰å¦‚æ­¤æ‰§ç€ï¼Ÿ

Stroustrup è®¨è®º `dynamic_cast` çš„ä¼˜åŒ–ï¼ˆè´¨æ•°å–æ¨¡æ³•ï¼‰ä»¥åŠå¼‚å¸¸çš„å¯é¢„æµ‹æ€§ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ä¸ºäº†æŠŠ C++ æ¨è¿›ç¡¬å®æ—¶é¢†åŸŸã€‚ä»–å¸Œæœ› C++ ç¨‹åºå‘˜èƒ½å¤Ÿå†™å‡ºï¼š
- é€»è¾‘ä¸Šæ­£ç¡®çš„ä»£ç ã€‚
- æ—¶é—´ä¸Šå¯é¢„æµ‹çš„ä»£ç ã€‚

å¦‚æœ dynamic_cast æ¶ˆè€—çš„æ—¶é—´å–å†³äºç»§æ‰¿æ ‘çš„æ·±åº¦ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯â€œä¸ç¡®å®šâ€çš„ï¼Œä¹Ÿå°±æ— æ³•ç”¨äºæ§åˆ¶ç«æ˜Ÿæ¢æµ‹å™¨çš„é™è½ä¼å¼€å¯ã€‚Stroustrup åœ¨è®ºæ–‡é‡Œå¯¹å¼‚å¸¸å¤„ç†ï¼ˆExceptionsï¼‰å’ŒåŠ¨æ€åˆ†é…ï¼ˆMemory Allocationï¼‰è¡¨ç°å¾—å¦‚æ­¤è°¨æ…â€”â€”å› ä¸ºåœ¨èˆ¹èˆ¶å¼•æ“æˆ–ç«æ˜Ÿè½¦ï¼ˆMars Roverï¼Œè®ºæ–‡ç¬¬ 1 é¡µæåˆ°ï¼‰è¿™æ ·çš„ç³»ç»Ÿä¸­ï¼Œä¸€æ¬¡å»¶è¿Ÿå°±æ„å‘³ç€æ•´ä¸ªç‰©ç†ç³»ç»Ÿçš„å½»åº•ç»ˆç»“ã€‚


5. æ€§èƒ½å»ºè®®ï¼š ç¦ç”¨å¼‚å¸¸ï¼Œç¦ç”¨rtti

- ç©ºé—´å¼€é”€ï¼šå¼€å¯ RTTI ä¼šå¢åŠ å¯æ‰§è¡Œæ–‡ä»¶çš„å¤§å°ï¼ˆå› ä¸ºè¦å­˜å‚¨ç±»å‹å­—ç¬¦ä¸²å’Œç»§æ‰¿å…³ç³»è¡¨ï¼‰ã€‚
- æ—¶é—´å¼€é”€ï¼šdynamic_cast æ¯”æ™®é€šè½¬æ¢æ…¢å¾—å¤šã€‚
- ç°ä»£åšæ³•ï¼šåœ¨å¾ˆå¤šé«˜æ€§èƒ½æˆ–åµŒå…¥å¼é¢†åŸŸï¼ˆå¦‚æ¸¸æˆå¼•æ“ã€åº•å±‚é©±åŠ¨ï¼‰ï¼Œå¼€å‘è€…å¸¸é€šè¿‡ç¼–è¯‘å™¨é€‰é¡¹ï¼ˆå¦‚ -fno-rttiï¼‰å½»åº•ç¦ç”¨ RTTIï¼Œè½¬è€Œä½¿ç”¨æ‰‹åŠ¨å®šä¹‰çš„ enum æˆ–æ¨¡æ¿æŠ€æœ¯ï¼ˆå¦‚ std::variantï¼‰æ¥æ›¿ä»£ã€‚

åœ¨ç›®å‰çš„ç¡¬å®æ—¶å·¥ä¸šç•Œï¼ˆå¦‚æ±½è½¦è‡ªåŠ¨é©¾é©¶ã€å«æ˜Ÿæ§åˆ¶ï¼‰ï¼Œæœ€ä¸»æµçš„åšæ³•ä¾ç„¶æ˜¯ç¦ç”¨å¼‚å¸¸ï¼ˆä½¿ç”¨ç¼–è¯‘é€‰é¡¹ -fno-exceptionsï¼‰ã€‚è¿™æ­£æ˜¯ Stroustrup åœ¨è®ºæ–‡ä¸­æåˆ°çš„â€œä¼ ç»Ÿé”™è¯¯å¤„ç†ç­–ç•¥â€çš„ç°ä»£åŒ–å»¶ç»­ã€‚

---

## æ€§èƒ½ä¼˜åŒ–

### é¿å…Cache missçš„æ–¹æ³•

#### 1.æ•°æ®å±€éƒ¨æ€§: è·³è·ƒè®¿é—® â†’ é¡ºåºè®¿é—®

```cpp
// âŒ åï¼šè·³è·ƒè®¿é—®
for (int i = 0; i < N; i++) {
    sum += arr[i * 1000];  // å¯èƒ½æ¯æ¬¡éƒ½ miss
}

// âœ… å¥½ï¼šé¡ºåºè®¿é—®
for (int i = 0; i < N; i++) {
    sum += arr[i];  // åˆ©ç”¨é¢„å–
}
```

#### 2. æ•°æ®ç»“æ„é‡æ’ï¼ˆAoS â†’ SoAï¼‰

ç»“æ„ä½“æ”¾åœ¨æ•°ç»„ vs æ•°ç»„æ”¾åœ¨ç»“æ„ä½“

```cpp
// âŒ Array of Structures (AoS)
struct Point {
    float x, y, z;
    int id;
    char name[32];
};
Point points[1000];

// åªè®¿é—® x åæ ‡ï¼Œä½†åŠ è½½äº†æ•´ä¸ªç»“æ„
for (int i = 0; i < 1000; i++) {
    sum += points[i].x;  // æµªè´¹ç¼“å­˜
}

// âœ… Structure of Arrays (SoA)
struct Points {
    float x[1000];
    float y[1000];
    float z[1000];
    // ...
};
Points points;

// ç´§å¯†æ’åˆ—ï¼Œç¼“å­˜å‹å¥½
for (int i = 0; i < 1000; i++) {
    sum += points.x[i];  // é«˜æ•ˆï¼
}
```

#### 3. é¢„å–ï¼ˆPrefetchï¼‰- SSEæŒ‡ä»¤é›†

```cpp
#include <xmmintrin.h>

for (int i = 0; i < N; i++) {
    // æå‰åŠ è½½ä¸‹ä¸€æ¬¡è¿­ä»£çš„æ•°æ®,_MM_HINT_T0è¡¨ç¤ºæ‰€æœ‰çº§åˆ«çš„ç¼“å­˜ï¼ˆL1, L2, L3ï¼‰
    _mm_prefetch(&arr[i + 8], _MM_HINT_T0); 
    
    process(arr[i]);
}
```

å…¸å‹ç”¨æ³•ï¼š
å¸¸ç”¨çš„åœºæ™¯æ˜¯åœ¨éå†å¤§å‹æ•°ç»„æˆ–é“¾è¡¨æ—¶ï¼Œåœ¨å¤„ç†å½“å‰å…ƒç´ çš„åŒæ—¶ï¼Œé¢„å–åé¢è‹¥å¹²ä¸ªå…ƒç´ ã€‚

é¿å‘ï¼š
1. ä¸è¦è¿‡åº¦é¢„å–ï¼šé¢„å–æœ¬èº«æ˜¯ä¸€æ¡æŒ‡ä»¤ï¼Œä¼šæ¶ˆè€—æ‰§è¡Œèµ„æºã€‚å¦‚æœæ•°æ®å·²ç»åœ¨ç¼“å­˜ä¸­ï¼Œé¢„å–æŒ‡ä»¤å°±æ˜¯çº¯ç²¹çš„æµªè´¹ã€‚
2. æ‰¾å‡†â€œé¢„å–è·ç¦»â€ï¼šé¢„å–å¤ªæ™šï¼Œæ•°æ®è¿˜æ²¡åˆ° CPU å°±å·²ç»è¿è¡Œåˆ°é‚£è¡Œäº†ï¼›é¢„å–å¤ªæ—©ï¼Œæ•°æ®å¯èƒ½ä¼šåœ¨è¢«ä½¿ç”¨å‰å°±è¢«è¸¢å‡ºç¼“å­˜ã€‚é€šå¸¸è®¾ç½®ä¸ºæœªæ¥ 2-4 ä¸ªç¼“å­˜è¡Œï¼ˆçº¦ 128-256 å­—èŠ‚ï¼‰çš„ä½ç½®ã€‚
3. å¯¹é½è¦æ±‚ï¼š_mm_prefetch å¯¹åœ°å€å¯¹é½æ²¡æœ‰å¼ºåˆ¶è¦æ±‚ï¼ˆå®ƒä¸ä¼šè§¦å‘é¡µé¢é”™è¯¯æˆ–åˆ†æ®µé”™è¯¯ï¼‰ï¼Œå³ä½¿ä¼ å…¥éæ³•åœ°å€ï¼ŒCPU ä¹Ÿä¼šç›´æ¥å¿½ç•¥è¯¥æŒ‡ä»¤ã€‚
4. è®¡ç®—å¯†é›†å‹ vs å†…å­˜å¯†é›†å‹ï¼šå¦‚æœä½ çš„å¾ªç¯å·²ç»æ˜¯è®¡ç®—å¯†é›†çš„ï¼ˆCPU å¿™å¾—ä¸å¯å¼€äº¤ï¼‰ï¼Œé¢„å–å¯èƒ½æ— æ³•æå‡æ€§èƒ½ï¼›å®ƒä¸»è¦ç”¨äº**å†…å­˜å—é™ï¼ˆMemory-boundï¼‰**çš„åœºæ™¯ã€‚

#### 4. ç¼“å­˜å¯¹é½

```cpp
// âœ… å¯¹é½åˆ°ç¼“å­˜è¡Œ
alignas(64) struct Data {
    int value;
};
```

#### 5. åˆ†å—å¤„ç†ï¼ˆBlocking/Tilingï¼‰



### ç¼“å­˜å¯¹é½ï¼š å¤šæ ¸å¹¶å‘çš„ä¼ªå…±äº«é—®é¢˜

ç°ä»£ CPU ä»¥ç¼“å­˜è¡Œï¼ˆCache Lineï¼‰ä¸ºå•ä½åŠ è½½æ•°æ®ï¼š
- å…¸å‹å¤§å°64 å­—èŠ‚ï¼ˆä¹Ÿå¯èƒ½æ˜¯ 32ã€128 å­—èŠ‚ï¼‰
- å³ä½¿åªè®¿é—® 1 å­—èŠ‚ï¼ŒCPU ä¹Ÿä¼šåŠ è½½æ•´ä¸ªç¼“å­˜è¡Œ

ä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«è®¿é—®ä¸åŒçš„å˜é‡ï¼Œä½†è¿™äº›å˜é‡åœ¨åŒä¸€ä¸ªç¼“å­˜è¡Œä¸­ã€‚

```cpp
struct Data {
    int counter1;  // çº¿ç¨‹1 ä¿®æ”¹
    int counter2;  // çº¿ç¨‹2 ä¿®æ”¹
};

Data data;

// çº¿ç¨‹1
void thread1() {
    for (int i = 0; i < 1000000; i++) {
        data.counter1++;  // ä¿®æ”¹ counter1
    }
}

// çº¿ç¨‹2
void thread2() {
    for (int i = 0; i < 1000000; i++) {
        data.counter2++;  // ä¿®æ”¹ counter2
    }
}
```

**é—®é¢˜**ï¼š

1. `counter1` å’Œ `counter2` åœ¨åŒä¸€ç¼“å­˜è¡Œ
2. çº¿ç¨‹1 ä¿®æ”¹ `counter1` â†’ æ•´ä¸ªç¼“å­˜è¡Œå¤±æ•ˆ
3. çº¿ç¨‹2 çš„ç¼“å­˜è¡Œå¤±æ•ˆ â†’ éœ€è¦é‡æ–°åŠ è½½
4. çº¿ç¨‹2 ä¿®æ”¹ `counter2` â†’ çº¿ç¨‹1 çš„ç¼“å­˜è¡Œåˆå¤±æ•ˆ
5. **ä¸åœåœ°ç¼“å­˜å¤±æ•ˆå’Œé‡æ–°åŠ è½½** â†’ æ€§èƒ½æš´é™

æ— ä¼ªå…±äº«ï¼ˆGoodï¼‰:   

ç¼“å­˜è¡Œ1ï¼ˆ64å­—èŠ‚ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   
â”‚ counter1 â”‚    ... padding ...         â”‚   
â”‚  (4B)    â”‚                            â”‚   
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    
    â†‘   
  çº¿ç¨‹1    

ç¼“å­˜è¡Œ2ï¼ˆ64å­—èŠ‚ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   
â”‚ counter2 â”‚    ... padding ...         â”‚  
â”‚  (4B)    â”‚                            â”‚  
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    
    â†‘
  çº¿ç¨‹2  
  
ä¸¤ä¸ªçº¿ç¨‹ç‹¬ç«‹çš„ç¼“å­˜è¡Œï¼Œäº’ä¸å¹²æ‰°ï¼

è§£å†³æ–¹æ¡ˆï¼šç¼“å­˜å¯¹é½

æ–¹æ³• 1ï¼š `alignas` å…³é”®å­—ï¼ˆC++11ï¼‰

```cpp
#include <iostream>
#include <thread>
#include <chrono>

// âŒ æ— å¯¹é½ï¼ˆæœ‰ä¼ªå…±äº«ï¼‰
struct NoAlignment {
    int counter1;
    int counter2;
};

// âœ… æœ‰å¯¹é½ï¼ˆæ— ä¼ªå…±äº«ï¼‰
struct WithAlignment {
    alignas(64) int counter1;
    alignas(64) int counter2;
};

template<typename T>
void benchmark(const char* name) {
    T data{};
    
    auto thread1 = [&]() {
        for (int i = 0; i < 100000000; i++) {
            data.counter1++;
        }
    };
    
    auto thread2 = [&]() {
        for (int i = 0; i < 100000000; i++) {
            data.counter2++;
        }
    };
    
    auto start = std::chrono::high_resolution_clock::now();
    
    std::thread t1(thread1);
    std::thread t2(thread2);
    
    t1.join();
    t2.join();
    
    auto end = std::chrono::high_resolution_clock::now();
    auto duration = std::chrono::duration_cast<std::chrono::milliseconds>(end - start);
    
    std::cout << name << ": " << duration.count() << " ms\n";
}

int main() {
    benchmark<NoAlignment>("æ— å¯¹é½ï¼ˆä¼ªå…±äº«ï¼‰");
    benchmark<WithAlignment>("æœ‰å¯¹é½ï¼ˆæ— ä¼ªå…±äº«ï¼‰");
}
```

**å…¸å‹è¾“å‡º**ï¼ˆåŒæ ¸ç³»ç»Ÿï¼‰ï¼š
```
æ— å¯¹é½ï¼ˆä¼ªå…±äº«ï¼‰: 2500 ms
æœ‰å¯¹é½ï¼ˆæ— ä¼ªå…±äº«ï¼‰: 800 ms
```

æ€§èƒ½æå‡ï¼šçº¦ 3 å€ï¼

æ–¹æ³• 2ï¼šæ‰‹åŠ¨å¡«å……ï¼ˆPaddingï¼‰

```cpp
struct PaddedCounter {
    int value;
    char padding[60];  // 4 + 60 = 64 å­—èŠ‚
};

struct Data {
    PaddedCounter counter1;
    PaddedCounter counter2;
};

```

æ–¹æ³• 3ï¼š alignas + hardware_destructive_interference_size

```cpp
#include <new>  // C++17

struct Counter {
    alignas(std::hardware_destructive_interference_size) int value;
};
```
- hardware_destructive_interference_sizeï¼šé¿å…ä¼ªå…±äº«çš„æœ€å°å¯¹é½å¤§å°
- hardware_constructive_interference_sizeï¼šä¿ƒè¿›å…±äº«çš„æœ€å¤§å¯¹é½å¤§å°

#### å®é™…åº”ç”¨åœºæ™¯

åœºæ™¯ 1ï¼šå¤šçº¿ç¨‹è®¡æ•°å™¨

```cpp
#include <atomic>

// âŒ é”™è¯¯ï¼šæ‰€æœ‰è®¡æ•°å™¨åœ¨åŒä¸€ç¼“å­˜è¡Œ
struct BadCounters {
    std::atomic<int> thread1_count;
    std::atomic<int> thread2_count;
    std::atomic<int> thread3_count;
    std::atomic<int> thread4_count;
};

// âœ… æ­£ç¡®ï¼šæ¯ä¸ªè®¡æ•°å™¨ç‹¬å ç¼“å­˜è¡Œ
struct GoodCounters {
    alignas(64) std::atomic<int> thread1_count;
    alignas(64) std::atomic<int> thread2_count;
    alignas(64) std::atomic<int> thread3_count;
    alignas(64) std::atomic<int> thread4_count;
};
```

åœºæ™¯ 2ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…é˜Ÿåˆ—

```cpp
template<typename T>
class LockFreeQueue {
    // âœ… å¤´å°¾æŒ‡é’ˆåˆ†åˆ«å¯¹é½ï¼Œé¿å…ä¼ªå…±äº«
    alignas(64) std::atomic<size_t> head_;
    alignas(64) std::atomic<size_t> tail_;
    
    std::vector<T> buffer_;
};
```
åœºæ™¯ 3ï¼šçº¿ç¨‹å±€éƒ¨æ•°æ®

```cpp
struct ThreadLocalData {
    alignas(64) int processed_count;
    alignas(64) int error_count;
    alignas(64) double total_time;
};

// æ¯ä¸ªçº¿ç¨‹ä¸€ä¸ªå®ä¾‹
std::vector<ThreadLocalData> thread_data(num_threads);
```

åœºæ™¯ 3ï¼šçº¿ç¨‹å±€éƒ¨æ•°æ®

```cpp
struct ThreadLocalData {
    alignas(64) int processed_count;
    alignas(64) int error_count;
    alignas(64) double total_time;
};
// æ¯ä¸ªçº¿ç¨‹ä¸€ä¸ªå®ä¾‹
std::vector<ThreadLocalData> thread_data(num_threads);
```

åœºæ™¯ 4ï¼šè¯»å†™åˆ†ç¦»

```cpp
struct ThreadLocalData {
    alignas(64) int processed_count;
    alignas(64) int error_count;
    alignas(64) double total_time;
};

// æ¯ä¸ªçº¿ç¨‹ä¸€ä¸ªå®ä¾‹
std::vector<ThreadLocalData> thread_data(num_threads);
```

### æ•°æ®æ€§èƒ½ï¼š æ•°ç»„ > é“¾è¡¨ï¼ˆå†…å­˜æ± ï¼‰ > é“¾è¡¨ï¼ˆä¼ ç»Ÿï¼‰

```cpp
class NodePool {
    static constexpr size_t POOL_SIZE = 1000;
    Node nodes[POOL_SIZE];
    size_t next_index = 0;
    
public:
    Node* allocate(int data) {
        if (next_index >= POOL_SIZE) {
            throw std::bad_alloc();
        }
        Node* node = &nodes[next_index++];
        node->data = data;
        node->next = nullptr;
        return node;
    }
};

// ä½¿ç”¨å†…å­˜æ± 
NodePool pool;
Node* n1 = pool.allocate(1);  // åœ¨ pool ä¸­è¿ç»­åˆ†é…
Node* n2 = pool.allocate(2);
Node* n3 = pool.allocate(3);

// ä½¿ç”¨æ—¶ä»ç„¶æ˜¯é“¾è¡¨çš„æ“ä½œæ–¹å¼
Node* head = pool.allocate(1);
head->next = pool.allocate(2);
head->next->next = pool.allocate(3)

// éå†ä»ç„¶æ˜¯é“¾è¡¨æ–¹å¼
Node* current = head;
while (current != nullptr) {
    std::cout << current->data;
    current = current->next;  // â† ä»ç„¶ç”¨æŒ‡é’ˆé“¾æ¥
}
```

**æ•ˆæœ**ï¼š

```text
Pool å†…å­˜ï¼ˆè¿ç»­ï¼‰ï¼š
åœ°å€      å†…å®¹
------   --------
0x2000   [1][next]
0x2010   [2][next]
0x2020   [3][next]

è®¿å­˜æ›´è¿ç»­ï¼Œç¼“å­˜å‘½ä¸­ç‡æé«˜ï¼
```

å†…å­˜æ± çš„æ ¸å¿ƒæ€æƒ³ï¼š**ç”¨æ•°ç»„æ¥å­˜å‚¨é“¾è¡¨èŠ‚ç‚¹ï¼Œè·å¾—æ•°ç»„çš„å†…å­˜è¿ç»­æ€§ä¼˜åŠ¿ã€‚**

```cpp
// ä¼ ç»Ÿé“¾è¡¨ï¼šæ¯ä¸ªèŠ‚ç‚¹å•ç‹¬ newï¼Œåˆ†æ•£åœ¨å †ä¸Š
Node* n1 = new Node(1);  // å¯èƒ½åœ¨ 0x1000
Node* n2 = new Node(2);  // å¯èƒ½åœ¨ 0x5A00
Node* n3 = new Node(3);  // å¯èƒ½åœ¨ 0x2B00

// å†…å­˜æ± ï¼šèŠ‚ç‚¹å­˜å‚¨åœ¨è¿ç»­çš„æ•°ç»„ä¸­
Node nodes[1000];        // è¿ç»­å†…å­˜ï¼š0x2000-0x5000
Node* n1 = &nodes[0];    // åœ¨ 0x2000
Node* n2 = &nodes[1];    // åœ¨ 0x2010ï¼ˆè¿ç»­ï¼ï¼‰
Node* n3 = &nodes[2];    // åœ¨ 0x2020ï¼ˆè¿ç»­ï¼ï¼‰
```

å†…å­˜æ± å¿« 7 å€å·¦å³ï¼Œ é¢„å–æœ‰æ•ˆã€‚

---

### å¾ªç¯å±•å¼€

å‡å°‘å¾ªç¯è¿­ä»£çš„æ¬¡æ•°ï¼Œå¹¶åœ¨æ¯ä¸€æ¬¡å¾ªç¯ä¸­å¤šåšå‡ æ¬¡é‡å¤çš„å·¥ä½œã€‚

æ™®é€šå¾ªç¯

```cpp
for (int i = 0; i < 100; i++) {
    box[i] = apple[i];
}
```

å¾ªç¯å±•å¼€ï¼ˆå±•å¼€å› å­ä¸º 4ï¼‰

```cpp
for (int i = 0; i < 100; i += 4) {
    box[i] = apple[i];
    box[i + 1] = apple[i + 1];
    box[i + 2] = apple[i + 2];
    box[i + 3] = apple[i + 3];
}
```

1.å¾ªç¯å±•å¼€çš„å¥½å¤„ã€‚åœ¨åº•å±‚ CPU æ‰§è¡Œæ—¶ï¼Œå¾ªç¯å±•å¼€èƒ½æ˜¾è‘—æå‡æ€§èƒ½ï¼ŒåŸå› æœ‰ä¸‰ï¼š

- å‡å°‘ç®¡ç†å¼€é”€ï¼šå‡å°‘äº†å¾ªç¯å˜é‡ï¼ˆå¦‚ i++ï¼‰çš„è‡ªå¢æ¬¡æ•°ï¼Œä»¥åŠåˆ¤æ–­å¾ªç¯æ˜¯å¦ç»“æŸï¼ˆå¦‚ i < 100ï¼‰çš„æ¯”è¾ƒè·³è½¬æŒ‡ä»¤ã€‚
- æå‡â€œæŒ‡ä»¤çº§å¹¶è¡Œâ€ï¼ˆILPï¼‰ï¼š ç°ä»£ CPU åƒæµæ°´çº¿å·¥å‚ã€‚å¦‚æœä¸€æ¬¡å¾ªç¯é‡Œåªæœ‰ä¸€è¡Œä»£ç ï¼Œæµæ°´çº¿è¿˜æ²¡è·‘èµ·æ¥å°±å¾—ç­‰ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚å±•å¼€åï¼ŒCPU å‘ç°è¿™ 4 è¡Œæ¬è‹¹æœçš„ä»£ç äº’ä¸å¹²æ‰°ï¼Œå¯ä»¥åŒæ—¶å¯åŠ¨ 4 ä¸ªâ€œæœºæ¢°è‡‚â€ä¸€èµ·æ¬ã€‚
- å‡å°‘åˆ†æ”¯é¢„æµ‹å¤±è´¥ï¼šCPU æ€»æ˜¯é¢„åˆ¤ä½ ä¼šç»§ç»­å¾ªç¯ã€‚æ¯å¤šä¸€æ¬¡è·³è½¬ï¼Œé¢„åˆ¤å‡ºé”™çš„æ¦‚ç‡å°±å¤šä¸€åˆ†ã€‚å±•å¼€å‡å°‘äº†è·³è½¬æ¬¡æ•°ï¼Œä¹Ÿå°±è®© CPU è·‘å¾—æ›´é¡ºã€‚

2.å±•å¼€çš„â€œä»£ä»·â€ï¼ˆå‰¯ä½œç”¨ï¼‰ã€‚è™½ç„¶è·‘å¾—å¿«ï¼Œä½†ä¸æ˜¯å±•å¼€å¾—è¶Šå¤šè¶Šå¥½ï¼š

- ä»£ç è†¨èƒ€ï¼ˆCode Bloatï¼‰ï¼šäºŒè¿›åˆ¶æ–‡ä»¶ä¼šå˜å¤§ã€‚å¦‚æœä»£ç å¤§åˆ° CPU çš„æŒ‡ä»¤ç¼“å­˜ï¼ˆInstruction Cacheï¼‰è£…ä¸ä¸‹äº†ï¼Œåè€Œä¼šå› ä¸ºé¢‘ç¹å»å†…å­˜è¯»å–æŒ‡ä»¤è€Œå¯¼è‡´ä¸¥é‡æ‰é€Ÿã€‚
- å¯„å­˜å™¨å‹åŠ›ï¼šå¦‚æœä¸€æ¬¡å¾ªç¯é‡Œå¤„ç†çš„ä»»åŠ¡å¤ªå¤šï¼ŒCPU çš„å¯„å­˜å™¨ï¼ˆæœ€å¿«çš„ä¸´æ—¶å­˜å‚¨ç©ºé—´ï¼‰ä¸å¤Ÿç”¨äº†ï¼Œå°±å¾—æŠŠæ•°æ®å†™å›è¾ƒæ…¢çš„å†…å­˜ï¼Œé€‚å¾—å…¶åã€‚

3.è°æ¥åšè¿™ä»¶äº‹ï¼Ÿ

- ç¼–è¯‘å™¨ï¼šè¿™æ˜¯æœ€æ¨èçš„æ–¹å¼ã€‚åƒ GCC æˆ– Clang ç¼–è¯‘å™¨åœ¨ -O2 æˆ– -O3 ä¼˜åŒ–çº§åˆ«ä¸‹ï¼Œä¼šè‡ªåŠ¨æ ¹æ®ä½ çš„ CPU ç±»å‹åˆ¤æ–­æ˜¯å¦è¯¥å±•å¼€ã€‚
- æ‰‹åŠ¨å±•å¼€ï¼šåœ¨æç«¯é«˜æ€§èƒ½éœ€æ±‚ä¸‹ï¼ˆå¦‚ä½  JSF++ èˆªå¤©ä»£ç æˆ– è‡ªåŠ¨é©¾é©¶ FSDï¼‰ï¼Œç¨‹åºå‘˜æœ‰æ—¶ä¼šæ‰‹åŠ¨å±•å¼€ï¼Œæˆ–è€…ä½¿ç”¨ `#pragma unroll`æŒ‡ä»¤å‘Šè¯‰ç¼–è¯‘å™¨ï¼šâ€œå¬æˆ‘çš„ï¼Œè¿™é‡Œå¿…é¡»å±•å¼€â€ã€‚

---

### å†…è”ï¼ˆInliningï¼‰

æŠŠå‡½æ•°è°ƒç”¨çš„æŒ‡ä»¤ï¼Œç›´æ¥æ›¿æ¢ä¸ºå‡½æ•°ä½“å†…çš„å…·ä½“ä»£ç ã€‚

1. ç›®çš„æ˜¯æ¶ˆé™¤å‡½æ•°è°ƒç”¨çš„å¼€é”€ï¼Œçœå»äº†å‚æ•°ä¼ é€’ã€ä¿å­˜å¯„å­˜å™¨ã€æŒ‡ä»¤è·³è½¬å’Œè¿”å›çš„æ—¶é—´ã€‚å¯¹äºåªæœ‰ä¸€ä¸¤è¡Œä»£ç çš„å°å‡½æ•°ï¼Œè°ƒç”¨å®ƒçš„å¼€é”€å¾€å¾€æ¯”æ‰§è¡Œå®ƒçš„æ—¶é—´è¿˜é•¿ã€‚
2. è§¦å‘è¿›ä¸€æ­¥ä¼˜åŒ–ï¼šå†…è”åï¼ŒåŸæœ¬åˆ†æ•£åœ¨ä¸¤ä¸ªå‡½æ•°é‡Œçš„ä»£ç â€œè¿åœ¨äº†ä¸€èµ·â€ã€‚ç¼–è¯‘å™¨ç°åœ¨èƒ½çœ‹åˆ°å…¨å±€ï¼Œå¯èƒ½ä¼šå‘ç° a * a é‡Œçš„ a æ˜¯å¸¸é‡ 5ï¼Œä»è€Œç›´æ¥æŠŠç»“æœé¢„è®¡ç®—ä¸º 25ï¼ˆè¿™å«å¸¸é‡æŠ˜å ï¼‰ã€‚
3. å¯¹æŒ‡ä»¤æµæ°´çº¿å‹å¥½ï¼šCPU å–œæ¬¢ç›´çº¿è¡Œé©¶ã€‚å†…è”æ¶ˆé™¤äº†â€œå¼¯é“â€ï¼ˆè·³è½¬æŒ‡ä»¤ï¼‰ï¼Œè®© CPU çš„åˆ†æ”¯é¢„æµ‹å™¨è·‘å¾—æ›´ç¨³ï¼Œæµæ°´çº¿æ›´é«˜æ•ˆã€‚

å†…è”çš„â€œä»£ä»·â€ï¼ˆå‰¯ä½œç”¨ï¼‰ï¼š

- ä»£ç è†¨èƒ€ï¼ˆCode Bloatï¼‰ï¼šå¦‚æœä¸€ä¸ªå¾ˆå¤§çš„å‡½æ•°åœ¨ 100 ä¸ªåœ°æ–¹è¢«å†…è”ï¼Œä½ çš„ç¨‹åºä½“ç§¯ä¼šè¿…é€Ÿçˆ†ç‚¸ã€‚
- ç¼“å­˜å¤±æ•ˆç‡ï¼ˆCache Missï¼‰ï¼šå¦‚æœäºŒè¿›åˆ¶æ–‡ä»¶å¤ªå¤§ï¼Œè¶…å‡ºäº† CPU çš„æŒ‡ä»¤ç¼“å­˜ï¼ˆL1 i-Cacheï¼‰ï¼ŒCPU å°±å¾—ä»æ…¢é€Ÿçš„å†…å­˜é‡Œè¯»å–æŒ‡ä»¤ï¼Œæ€§èƒ½åè€Œä¼šæ–­å´–å¼ä¸‹è·Œã€‚

ç¨‹åºå‘˜å¦‚ä½•æ§åˆ¶å†…è”ï¼Ÿ

- inline å…³é”®å­—ï¼šè¿™åªæ˜¯ç»™ç¼–è¯‘å™¨çš„ä¸€ä¸ªâ€œå»ºè®®â€ã€‚ç¼–è¯‘å™¨å¾ˆèªæ˜ï¼Œå¦‚æœä½ å»ºè®®å†…è”ä¸€ä¸ª 1000 è¡Œçš„å¤æ‚å‡½æ•°ï¼Œå®ƒé€šå¸¸ä¼šæ‹’ç»ã€‚
- ç¼–è¯‘å™¨è‡ªåŠ¨ä¼˜åŒ–ï¼šåœ¨ -O2 æˆ– -O3 çº§åˆ«ä¸‹ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åˆ†æå“ªäº›å‡½æ•°å€¼å¾—å†…è”ï¼ˆé€šå¸¸æ˜¯é‚£äº›é€»è¾‘ç®€å•ã€é¢‘ç¹è°ƒç”¨çš„å‡½æ•°ï¼‰ã€‚
- å¼ºåˆ¶å†…è”ï¼šåœ¨æŸäº›ä¸¥è‹›åœºæ™¯ä¸‹ï¼Œç¨‹åºå‘˜ä¼šä½¿ç”¨ __attribute__((always_inline))ï¼ˆGCC/Clangï¼‰æ¥å‘½ä»¤ç¼–è¯‘å™¨å¿…é¡»æ‰§è¡Œå†…è”ã€‚




### C++çš„ç¼ºé™·ä¸æ€§èƒ½ä¼˜åŒ–

#### C++çš„æœºå™¨æ¨¡å‹çš„ç¼ºé™·

C++ ä¸­æ²¡æœ‰ä»»ä½•ä¸œè¥¿å¯ä»¥æ–¹ä¾¿åœ°è¡¨è¾¾äºŒçº§ç¼“å­˜ï¼ˆ2nd level cacheï¼‰ã€å†…å­˜æ˜ å°„å•å…ƒï¼ˆmemory-mapping unitï¼‰ã€ROM æˆ–ä¸“ç”¨å¯„å­˜å™¨çš„æ¦‚å¿µã€‚è¿™äº›æ¦‚å¿µå¾ˆéš¾æŠ½è±¡ï¼ˆä»¥æœ‰ç”¨ä¸”å¯ç§»æ¤çš„æ–¹å¼è¡¨è¾¾ï¼‰ï¼Œä½†æ ‡å‡†åº“ç»„ä»¶æ­£åœ¨åŠªåŠ›è¡¨è¾¾è¿™ç§å›°éš¾çš„è®¾æ–½ã€‚

**å¯¹äºŒçº§ç¼“å­˜ï¼ˆL2 Cache / Cache Lineï¼‰çš„è¡¨è¾¾**

C++ æ— æ³•ç›´æ¥è®©ä½ æ§åˆ¶æ•°æ®è¿›å‡º L2 ç¼“å­˜ï¼Œä½†å®ƒå¼€å§‹å°è¯•è®©ä½ è¡¨è¾¾ â€œç¼“å­˜å¯¹é½â€ ä»¥é¿å…ä¼ªå…±äº«ï¼ˆFalse Sharingï¼‰ã€‚

std::hardware_destructive_interference_size (C++17): è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†åº“å¸¸é‡ï¼Œè¿”å›ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´ä¸ºäº†é¿å…ç”±äºå…±äº«åŒä¸€ä¸ªç¼“å­˜è¡Œï¼ˆCache Lineï¼‰è€Œå¯¼è‡´æ€§èƒ½ä¸‹é™æ‰€éœ€çš„æœ€å°åç§»é‡ã€‚

std::hardware_constructive_interference_size (C++17): è¿”å›ä¸€ä¸ªç¼“å­˜è¡Œçš„æœ€å¤§å°ºå¯¸ï¼Œå»ºè®®å°†ç›¸å…³è”çš„æ•°æ®æ”¾åœ¨è¿™ä¸ªèŒƒå›´å†…ï¼Œä»¥æé«˜ L1/L2 ç¼“å­˜çš„åˆ©ç”¨ç‡ã€‚

**å¯¹å†…å­˜æ˜ å°„å•å…ƒï¼ˆMMUï¼‰ä¸é¡µé¢çš„è¡¨è¾¾**
C++ ä¸ä¼šæ•™ä½ å¦‚ä½•å†™ä¸€ä¸ª MMU é©±åŠ¨ï¼Œä½†å®ƒå¼€å§‹æ¶‰åŠå†…å­˜é¡µé¢çš„æ¦‚å¿µï¼š

std::pmr (Polymorphic Memory Resources): C++17 å¼•å…¥çš„è‡ªå®šä¹‰å†…å­˜èµ„æºã€‚ä½ å¯ä»¥å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„ memory_resourceï¼Œä¸“é—¨å¤„ç†å†…å­˜æ˜ å°„ï¼ˆMemory-mappingï¼‰æˆ–å¤§é¡µå†…å­˜ï¼ˆHuge Pagesï¼‰ï¼Œä»è€Œé—´æ¥ä¸ MMU çš„è¡Œä¸ºå¯¹é½ã€‚

span ä¸å†…å­˜è¿ç»­æ€§: è™½ç„¶ä¸æ˜¯ç›´æ¥æ“ä½œé¡µè¡¨ï¼Œä½†æ ‡å‡†åº“é€šè¿‡ std::span ç­‰å·¥å…·å¼ºåŒ–äº†å¯¹åº•å±‚è¿ç»­ç‰©ç†/è™šæ‹Ÿå†…å­˜æ®µçš„æŠ½è±¡è¡¨è¾¾ã€‚

**å¯¹ä¸“ç”¨å¯„å­˜å™¨ä¸ ROM çš„è¡¨è¾¾**
è¿™äº›é€šå¸¸æ˜¯åµŒå…¥å¼å¼€å‘çš„åˆšéœ€ï¼Œæ ‡å‡†åº“ä¸»è¦é€šè¿‡ç±»å‹ç³»ç»Ÿæ¥æ¨¡æ‹Ÿè¿™äº›ç‰¹æ€§ï¼š

volatile å…³é”®å­—ï¼š è™½ç„¶å±äºæ ¸å¿ƒè¯­è¨€ï¼Œä½†å®ƒæ˜¯è¡¨è¾¾ä¸“ç”¨å¯„å­˜å™¨æ˜ å°„ï¼ˆMemory-mapped I/Oï¼‰çš„åŸºç¡€ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨â€œè¿™ä¸ªå€¼éšæ—¶ä¼šå˜ï¼Œä¸è¦åšä¼˜åŒ–â€ã€‚

std::byte (C++17)ï¼š æ˜ç¡®åŒºåˆ†â€œå†…å­˜å­—èŠ‚â€å’Œâ€œå­—ç¬¦â€ï¼Œåœ¨æ“ä½œå¯„å­˜å™¨ä½ï¼ˆbit-flippingï¼‰æ—¶æ¯” unsigned char æ›´å®‰å…¨ä¸”æ„å›¾æ˜ç¡®ã€‚

const ä¸ constexprï¼š è¿™æ˜¯è¡¨è¾¾ ROM çš„ä¸»è¦æ‰‹æ®µã€‚åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œæ ‡è®°ä¸º constexpr çš„å…¨å±€æ•°æ®é€šå¸¸ä¼šè¢«ç¼–è¯‘å™¨ç›´æ¥æ”¾ç½®åœ¨ ROM/Flash ä¸­ï¼Œè€Œä¸æ˜¯ RAMã€‚

**ä¸ºä»€ä¹ˆè¿™äº›è®¾æ–½å¾ˆéš¾æŠ½è±¡ï¼Ÿ**

æ ‡å‡†åº“å§”å‘˜ä¼šï¼ˆWG21ï¼‰åœ¨å¤„ç†è¿™äº›é—®é¢˜æ—¶é¢ä¸´ä¸‰å¤§æŒ‘æˆ˜ï¼š

- å¤šæ ·æ€§ï¼š æŸäº› DSP æˆ– NPU çš„å¯„å­˜å™¨æ¨¡å‹ä¸é€šç”¨ CPU å®Œå…¨ä¸åŒï¼Œå¾ˆéš¾å†™å‡ºä¸€å¥—é€šç”¨çš„ APIã€‚
- ä¸å¯ç§»æ¤æ€§ï¼š L2 ç¼“å­˜çš„å¤§å°åœ¨ç§»åŠ¨ç«¯å’ŒæœåŠ¡å™¨ç«¯å¤©å·®åœ°åˆ«ï¼Œä¸€æ—¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç ï¼Œå¯ç§»æ¤æ€§å°±æ¯äº†ã€‚
- é›¶æˆæœ¬æŠ½è±¡åŸåˆ™ï¼š ä»»ä½•æ ‡å‡†åº“çš„åŒ…è£…éƒ½ä¸èƒ½æ¯”æ‰‹å†™çš„æ±‡ç¼–æˆ–è£¸æŒ‡é’ˆæ“ä½œæ›´æ…¢ã€‚

**æ ‡å‡†åº“çš„æœ€æ–°åŠªåŠ›ï¼šstd::atomic å’Œå†…å­˜æ¨¡å‹**

è¿™æ˜¯ C++ è¡¨è¾¾ç¡¬ä»¶å›°éš¾è®¾æ–½æœ€æˆåŠŸçš„ä¾‹å­ã€‚

å†…å­˜é¡ºåºï¼ˆMemory Orderingï¼‰ï¼š é€šè¿‡ std::memory_order_acquire/releaseï¼ŒC++ æˆåŠŸåœ°æŠ½è±¡äº†ä¸åŒ CPU æ¶æ„ï¼ˆå¦‚ x86 çš„å¼ºå†…å­˜åºä¸ ARM çš„å¼±å†…å­˜åºï¼‰åœ¨ç¼“å­˜ä¸€è‡´æ€§ä¸Šçš„å·®å¼‚ã€‚

---

#### C++åœ¨ç¡¬å®æ—¶ç³»ç»Ÿçš„ç¼ºé™·

1.è‡ªç”±å­˜å‚¨ï¼ˆnew/deleteï¼‰

- Predictabilityï¼Œå¯é¢„æµ‹æ€§ï¼šåˆ†é…æ‰€éœ€çš„æ—¶é—´å–å†³äºå¯ç”¨ç©ºé—²å†…å­˜çš„å¤§å°ï¼Œå†…å­˜ç¢ç‰‡åŒ–ä¼šå¯¼è‡´æ€§èƒ½éšæ—¶é—´æ¨ç§»è€Œä¸‹é™ã€‚è¿™æ„å‘³ç€å¯¹äºè®¸å¤šç³»ç»Ÿè€Œè¨€ï¼Œè‡ªç”±å­˜å‚¨æ— æ³•ä½¿ç”¨ï¼Œæˆ–è€…åªèƒ½åœ¨å¯åŠ¨æ—¶ä½¿ç”¨ï¼ˆä¸è¿›è¡Œé‡Šæ”¾å°±ä¸ä¼šäº§ç”Ÿç¢ç‰‡ï¼‰ã€‚
- Fragmentation  ç¢ç‰‡åŒ–ï¼š è‡ªç”±å­˜å‚¨çš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œåœ¨åˆ†é…å’Œé‡Šæ”¾å¯¹è±¡åå¯èƒ½ä¼šå‡ºç°ç¢ç‰‡åŒ–ã€‚åœ¨å¯¹è±¡åˆ†é…å’Œé‡Šæ”¾åï¼Œå¯èƒ½ä¼šç•™ä¸‹ä¸€äº›æœªä½¿ç”¨çš„å†…å­˜æˆ–ç©ºé—´ã€‚å †ä¸­è¿™äº›æœªä½¿ç”¨çš„ç©ºéš™æˆ–ç©ºé—´è¢«ç§°ä¸ºå†…å­˜ç¢ç‰‡åŒ–ã€‚ç”±äºè¿™äº›ç©ºéš™å¾ˆå°ï¼Œè¿™æ ·çš„å†…å­˜ä½ç½®æ— æ³•ç”¨æ¥å­˜å‚¨æ–°å¯¹è±¡ï¼Œå¯¼è‡´å†…å­˜ç©ºé—´æµªè´¹ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ€»çš„å¯ç”¨è‡ªç”±å­˜å‚¨è¿œå°äºåˆå§‹å¯ç”¨çš„è‡ªç”±å­˜å‚¨ã€‚

é—®é¢˜ä¸åœ¨äº new æœ¬èº«ï¼Œè€Œåœ¨äº new å’Œ delete ä¸€èµ·ä½¿ç”¨ï¼Œè¿™ä¼šå¯¼è‡´ä¸€ç³»åˆ—çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾ã€‚è¯¦ç»†å‚è§(å¼ºçƒˆå»ºè®®é˜…è¯»): [Hard Real-Time and C++ Predictability](https://www.embeddedhow.com/post/hard-real-time-and-c-predictability)

æ›¿ä»£æ–¹æ¡ˆåŒ…æ‹¬é™æ€åˆ†é…ã€æ ˆåˆ†é…å’Œä½¿ç”¨å­˜å‚¨æ± ã€‚

2.é¿å…ä½¿ç”¨`dynamic_cast`

å°½é‡é¿å…åœ¨æ€§èƒ½æ•æ„Ÿçš„ä»£ç ä¸­ä½¿ç”¨ dynamic_cast, è¿™æ˜¯å› ä¸ºåœ¨æ ‡å‡†çš„ C++ å®ç°ä¸­ï¼Œå½“ä½ æ‰§è¡Œ dynamic_cast<Target*>(ptr) æ—¶ï¼Œç³»ç»Ÿéœ€è¦æ£€æŸ¥ ptr æŒ‡å‘çš„å¯¹è±¡æ˜¯å¦çœŸçš„æ´¾ç”Ÿè‡ª Targetã€‚ç¼–è¯‘å™¨ä¼šç”Ÿæˆä»£ç å»éå†â€œç±»ç»§æ‰¿æ ‘â€ï¼ˆInheritance Treeï¼‰ã€‚å¦‚æœç»§æ‰¿å…³ç³»å¾ˆæ·±æˆ–å­˜åœ¨å¤šé‡ç»§æ‰¿ï¼Œè¿™ç§éå†éå¸¸è€—æ—¶ä¸”è¿è¡Œæ—¶é—´ä¸ç¡®å®šï¼ˆä¸æ˜¯å¸¸æ•°æ—¶é—´ï¼‰ã€‚åœ¨å®æ—¶ç³»ç»Ÿï¼ˆå¦‚èˆªå¤©å™¨ã€è‡ªåŠ¨é©¾é©¶ï¼‰ä¸­ï¼Œè¿™ç§ä¸ç¡®å®šæ€§æ˜¯ä¸å¯æ¥å—çš„ã€‚

2005å¹´Bjarne Stroustrupçš„è§£å†³æ–¹æ¡ˆ(è´¨æ•°å’Œå–æ¨¡)ï¼š [Fast dynamic casting](https://www.stroustrup.com/fast_dynamic_casting.pdf)

2.ç¦ç”¨å¼‚å¸¸

å¤„ç†å¼‚å¸¸æ‰€éœ€çš„æ—¶é—´å–å†³äºä»å¼‚å¸¸æŠ›å‡ºç‚¹åˆ°æ•è·ç‚¹ä¹‹é—´çš„è·ç¦»ï¼ˆä»¥å‡½æ•°è°ƒç”¨æ¬¡æ•°è¡¡é‡ï¼‰ä»¥åŠåœ¨æ­¤è¿‡ç¨‹ä¸­éœ€è¦é”€æ¯çš„å¯¹è±¡æ•°é‡ã€‚å¦‚æœæ²¡æœ‰åˆé€‚çš„å·¥å…·ï¼Œå¾ˆéš¾é¢„æµ‹è¿™ä¸ªæ—¶é—´ï¼Œè€Œç›®å‰è¿˜æ²¡æœ‰è¿™æ ·çš„å·¥å…·ã€‚C++å¼‚å¸¸æœºåˆ¶ä»åŸºäºæ ˆå±•å¼€ï¼ˆstack unwindingï¼‰ï¼Œè¿™åœ¨ç°ä»£æ ‡å‡†ï¼ˆå¦‚C++23ï¼‰ä¸­æœªæ ¹æœ¬æ”¹å˜ã€‚å¤„ç†æ—¶é—´éæ’å®šï¼Œå–å†³äºè¿è¡Œæ—¶çŠ¶æ€ï¼ˆå¦‚æ ˆæ·±åº¦ã€ææ„å™¨è°ƒç”¨ï¼‰ï¼Œåœ¨ç¡¬å®æ—¶ä¸­ä»ä¸å¯é¢„æµ‹ï¼ˆæ— æ³•é¢„å…ˆä¿è¯æœ€åæƒ…å†µæ—¶é—´ï¼‰ã€‚æ ‡å‡†æœªå¼•å…¥ç¡®å®šæ€§ä¿è¯ã€‚



## ç¤ºä¾‹ç¼–ç¨‹

### åŸºç¡€çŸ¥è¯†ï¼š Union

1. Unionçš„é€šå¸¸ç”¨æ³•ï¼šèŠ‚çº¦ç©ºé—´ï¼Œå…±äº«å†…å­˜ã€‚2. ç±»å‹åŒå…³ï¼ˆtype punningï¼‰æˆ–è€…è¯´ä½çš„é‡è§£é‡Šï¼ˆBit Reinterpretationï¼‰ ã€‚

åœ¨C++ä¸­ï¼Œç±»å‹åŒå…³å®¹æ˜“å¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼Œä½†åœ¨Cè¯­è¨€ä¸­æ˜¯ç”±å®ç°å®šä¹‰çš„ã€‚
Unionçš„ç¼ºé™·ï¼Œstructéœ€è¦ä¸€ä¸ªtypeå­—æ®µç»´æŠ¤ç±»å‹ï¼›å› æ­¤ç°ä»£C++ç”¨`std::variant`ï¼Œä»£ç æ›´ç®€æ´ã€‚

```cpp
struct Packet {
    enum Type { INT, FLOAT, STRING } type;   // å¿…é¡»è¦ç»´æŠ¤ç±»å‹å­—æ®µ
    
    union {
        int i;
        float f;
        char str[32];
    } data;
};

void process(const Packet& p) {
    switch (p.type) {
        case Packet::INT:
            std::cout << p.data.i << '\n';
            break;
        case Packet::FLOAT:
            std::cout << p.data.f << '\n';
            break;
        case Packet::STRING:
            std::cout << p.data.str << '\n';
            break;
    }
}
```

2. è®¿é—®å­—èŠ‚è¡¨ç¤ºï¼ˆç”¨ char æ•°ç»„ï¼‰, åˆæ³•çš„

```
union ByteView {
    float f;
    uint32_t i;
    unsigned char bytes[4];  // âœ… åˆæ³•è®¿é—®æ–¹å¼
};

void print_bytes(float f) {
    ByteView bv;
    bv.f = f;
    
    for (int i = 0; i < 4; i++) {
        printf("%02X ", bv.bytes[i]);
    }
}
```

3. ç¤ºä¾‹ç½‘ç»œåè®®è§£æ

```cpp
union IPAddress {
    uint32_t addr;
    uint8_t octets[4];
};

void print_ip(uint32_t ip) {
    IPAddress addr;
    addr.addr = ip;
    
    printf("%d.%d.%d.%d\n", 
           addr.octets[0], addr.octets[1], 
           addr.octets[2], addr.octets[3]);
}
```
ç°ä»£C++20, ä¼˜å…ˆè€ƒè™‘`std::bit_cast`, æˆ–è€…ç”¨ `std::memcpy` ï¼ˆC++17ï¼‰

```cpp
void print_ip(uint32_t ip) {
    uint8_t octets[4];
    std::memcpy(octets, &ip, 4);
    
    printf("%d.%d.%d.%d\n", 
           octets[0], octets[1], octets[2], octets[3]);
}
```

å¿«é€Ÿå“ˆå¸Œï¼ˆä½æ··æ·†ï¼‰ï¼Œä½çš„é‡è§£é‡Šï¼ˆBit Reinterpretationï¼‰

```cpp
size_t hash_float(float f) {
    return std::bit_cast<uint32_t>(f);  // C++20
    // æˆ–
    uint32_t bits;
    std::memcpy(&bits, &f, sizeof(f));
    return bits;
}
```

4. IEEE 754 æµ®ç‚¹åˆ†æ

```cpp
struct FloatParts {
    uint32_t mantissa : 23;
    uint32_t exponent : 8;
    uint32_t sign : 1;
};

union FloatAnalyzer {
    float f;
    FloatParts parts;
    uint32_t bits;
};

void analyze(float f) {
    FloatAnalyzer fa;
    fa.f = f;
    
    std::cout << "ç¬¦å·: " << fa.parts.sign << '\n';
    std::cout << "æŒ‡æ•°: " << fa.parts.exponent << '\n';
    std::cout << "å°¾æ•°: " << fa.parts.mantissa << '\n';
}
```

å¼ºåˆ¶ç±»å‹è½¬æ¢ `(uint32_t)f`ä¼šå¯¼è‡´CPUä¼šæ‰§è¡Œæˆªæ–­æ“ä½œï¼Œä½†æ˜¯ä½çš„é‡è§£é‡Šè®©å†…å­˜æ•°æ®åŸå°ä¸åŠ¨ã€‚

### why lambda?

[] çš„åŒé‡ä½œç”¨ï¼š
- å‘Šè¯‰ç¼–è¯‘å™¨"è¿™æ˜¯ lambda"
- æŒ‡å®šæ•è·å“ªäº›å¤–éƒ¨å˜é‡

```cpp
[]() { return 42; }      // âœ… ä¸æ•è·ä»»ä½•å˜é‡
[x]() { return x; }      // âœ… æ•è·å˜é‡ x
[&y]() { y++; }          // âœ… æŒ‰å¼•ç”¨æ•è· y
[&]() { x++; y++; }      // âœ… æŒ‰å¼•ç”¨æ•è·æ‰€æœ‰
[=]() { return x + y; }  // âœ… æ•è·æ‰€æœ‰å¤–éƒ¨å˜é‡
[this]                   // æ•è·å½“å‰å¯¹è±¡,ç±»æˆå‘˜å‡½æ•°ä¸­ä½¿ç”¨
```

ä¸ºä»€ä¹ˆè¦ç”¨lambdaï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨å®šä¹‰å‡½æ•°ï¼Ÿ æˆ–è€…lambdaç›¸æ¯”æ‰‹åŠ¨å®šä¹‰å‡½æ•°ï¼Œä¼˜ç‚¹åœ¨å“ªé‡Œï¼Ÿ

ä½œç”¨1ï¼š å¯ä»¥æ•è·å¤–éƒ¨å˜é‡

```cpp
int threshold = 10;
int bonus = 5;

auto check = [threshold, bonus](int value) {
    return value > threshold ? value + bonus : value;
};

std::cout << check(15);  // 20
std::cout << check(8);   // 8
```

ä½œç”¨2: ä»£ç å±€éƒ¨æ€§ï¼Œä¸å¿…ä¸ºäº†å‡½æ•°å†…éƒ¨çš„ä»£ç å•ç‹¬åœ¨å¤–éƒ¨å®ç°ä¸€ä¸ªå‡½æ•°, æ›´å¥½çš„æ¨¡å—åŒ–ã€‚

ä¸‹è¿°ä»£ç ï¼Œå¦‚æœæŠŠlambdaå•ç‹¬å®ç°ï¼Œå°±ä¸å¾—ä¸å®šä¹‰ä¸€ä¸ªint g_errorCountå…¨å±€å˜é‡ã€‚
```cpp
void processData(std::vector<int>& data) {
    int errorCount = 0;
    
    // é€»è¾‘å°±åœ¨è¿™é‡Œï¼Œä¸€ç›®äº†ç„¶
    std::for_each(data.begin(), data.end(),
        [&errorCount](int value) {
            if (value < 0) {
                errorCount++;
                std::cout << "é”™è¯¯å€¼: " << value << '\n';
            }
        }
    );
    
    std::cout << "å…± " << errorCount << " ä¸ªé”™è¯¯\n";
}
```

ä½œç”¨3: æ¯æ¬¡è°ƒç”¨å¯ä»¥ä¸åŒ

```cpp
auto makeMultiplier(int factor) {
    return [factor](int x) { return x * factor; };  // æ•è·ä¸åŒçš„ factor
}

auto times2 = makeMultiplier(2);
auto times5 = makeMultiplier(5);

std::cout << times2(10);  // 20
std::cout << times5(10);  // 50
```

ä½œç”¨4: æ”¯æŒæ³›å‹ï¼Œè€Œæ‰‹åŠ¨å‡½æ•°éœ€è¦å€ŸåŠ©æ¨¡æ¿ã€‚

```cpp
// æ³›å‹ lambdaï¼Œé€‚ç”¨äºä»»ä½•ç±»å‹
auto print = [](const auto& value) {
    std::cout << value << '\n';
};

print(42);           // int
print(3.14);         // double
print("hello");      // const char*

// æ‰‹åŠ¨å‡½æ•°
template<typename T>
void print(const T& value) {
    std::cout << value << '\n';
}
```
ä½œç”¨5ï¼š é—­åŒ…ï¼ˆClosureï¼‰å¯ä»¥"è®°ä½"åˆ›å»ºæ—¶çš„ç¯å¢ƒ/çŠ¶æ€ï¼Œè€Œæ‰‹åŠ¨å‡½æ•°åšä¸åˆ°ã€‚

```cpp
auto makeCounter() {
    int count = 0;
    
    return [count]() mutable {  // æ•è· count
        return ++count;
    };
}

auto counter1 = makeCounter();
auto counter2 = makeCounter();

std::cout << counter1();  // 1
std::cout << counter1();  // 2
std::cout << counter2();  // 1  â† ç‹¬ç«‹çš„è®¡æ•°å™¨

```


### ç±»å‹å®¹å™¨ std::variant

1. å®ƒæ˜¯ Unionçš„å‡çº§ç‰ˆï¼Œæ˜¯ä¸€ä¸ªç±»å‹å®‰å…¨çš„è”åˆä½“ï¼ˆType-safe Unionï¼‰ã€‚ä¸ä¼ ç»Ÿçš„ union ä¸åŒï¼Œå®ƒçŸ¥é“è‡ªå·±å½“å‰å­˜å‚¨çš„æ˜¯å“ªç§ç±»å‹ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨å¤„ç†å¯¹è±¡çš„æ„é€ å’Œææ„ï¼Œæ˜¯ç°ä»£ C++ å¤„ç†â€œå¤šé€‰ä¸€â€æ•°æ®çš„æ ‡å‡†æ–¹å¼ã€‚
2. std::getè¯»å–æ•°æ®ï¼Œä½†éœ€è¦åˆ¤æ–­ç±»å‹,å¦‚æœç±»å‹ä¸åŒ¹é…ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚  holds_alternativeéœ€è¦ç”¨ifæ‰‹åŠ¨æ£€æŸ¥ã€‚
3. std::visitæœ€ä¼˜é›…ï¼š  é…åˆ Overloaded ï¼Œæ¨¡å¼åŒ¹é…ã€‚

åŸºæœ¬ç”¨æ³• get+variant:

```cpp
include <iostream>
#include <variant>
#include <string>

int main() {
    // 1. å®šä¹‰ä¸€ä¸ªå¯ä»¥å­˜æ”¾ int æˆ– string çš„å˜é‡
    std::variant<int, std::string> v;

    v = 42;             // ç°åœ¨å­˜å‚¨çš„æ˜¯ int
    v = "Hello Gemini"; // ç°åœ¨å­˜å‚¨çš„æ˜¯ stringï¼Œä¼šè‡ªåŠ¨å¤„ç†å†…å­˜

    // 2. è¯»å–æ•°æ® (ä½¿ç”¨ std::get)
    try {
        std::string s = std::get<std::string>(v);
        std::cout << "Value: " << s << std::endl;
    } catch (const std::bad_variant_access& e) {
        std::cout << "ç±»å‹é”™è¯¯: " << e.what() << std::endl;
    }

    return 0;
}
```

ä¼˜é›…çš„ç”¨æ³•ï¼Œæ­é…Pack expansion operatorã€‚
overloadedä½œç”¨ï¼Œç®€å•è¯´ï¼Œå°±æ˜¯å¯¹ä¸åŒç±»å‹é‡è½½operator()çš„æ“ä½œã€‚
æŠŠå¤šä¸ª lambda åˆå¹¶æˆä¸€ä¸ªæ‹¥æœ‰å¤šä¸ªé‡è½½ operator() çš„å¯¹è±¡ï¼Œè®© std::visit èƒ½æ ¹æ®ç±»å‹è‡ªåŠ¨é€‰æ‹©è°ƒç”¨å“ªä¸ª lambdaã€‚

visit+variant+overloadedï¼š

```cpp
#include <iostream>
#include <variant>

// è¾…åŠ©å·¥å…·ï¼šåˆå¹¶å¤šä¸ª lambda
template<class... Ts>                                      // å£°æ˜ ç»“æ„ä½“æ¨¡æ¿
struct overloaded : Ts... { using Ts::operator()...; };    // å®šä¹‰ ç»“æ„ä½“
template<class... Ts>                                      // å£°æ˜ æ¨å¯¼æŒ‡å¼•
overloaded(Ts...) -> overloaded<Ts...>;                    // å®šä¹‰ æ¨å¯¼æŒ‡å¼•

int main() {
    std::variant<int, float, std::string> v = 3.14f;

    std::visit(overloaded {
        [](int i) { std::cout << "Integer: " << i << std::endl; },
        [](float f) { std::cout << "Float: " << f << std::endl; },
        [](const std::string& s) { std::cout << "String: " << s << std::endl; }
    }, v);  // std::visit(è®¿é—®è€…, variantå¯¹è±¡);
}
```

åº”ç”¨åœºæ™¯ï¼š

1. ç±»å‹åˆ¤æ–­

```
std::variant<int, std::string, std::nullptr_t> data = getData();

std::visit(overloaded {
    [](int value) { 
        std::cout << "æ”¶åˆ°æ•°å­—: " << value << '\n'; 
    },
    [](const std::string& str) { 
        std::cout << "æ”¶åˆ°å­—ç¬¦ä¸²: " << str << '\n'; 
    },
    [](std::nullptr_t) { 
        std::cout << "æ”¶åˆ°ç©ºå€¼\n"; 
    }
}, data);
```

2. çŠ¶æ€æœº (State Machines)
åœ¨é€»è¾‘è®¾è®¡ä¸­ï¼Œå¯¹è±¡å¾€å¾€å¤„äºå¤šä¸ªçŠ¶æ€ä¹‹ä¸€ï¼Œæ¯ä¸ªçŠ¶æ€æºå¸¦çš„æ•°æ®ä¸åŒã€‚ä¼ ç»Ÿçš„ struct ä¼šå¯¼è‡´å†…å­˜æµªè´¹ï¼ˆæ‰€æœ‰å­—æ®µå¹¶å­˜ï¼‰ï¼Œè€Œ variant èƒ½å¤Ÿä¼˜é›…åœ°è¡¨è¾¾è¿™ç§äº’æ–¥æ€§ã€‚

```cpp
struct Idle {};
struct Connecting { std::string ip; };
struct Connected { int session_id; };
struct Disconnected { std::string reason; };

using ConnectionState = std::variant<Idle, Connecting, Connected, Disconnected>;

// ä½¿ç”¨ std::visit å¤„ç†ä¸åŒçŠ¶æ€
void handle_state(const ConnectionState& state) {
    std::visit(overloaded {
        [](const Idle&) { /* æ˜¾ç¤ºåˆå§‹ç•Œé¢ */ },
        [](const Connecting& c) { std::cout << "Connecting to " << c.ip; },
        [](const Connected& c) { std::cout << "Session: " << c.session_id; },
        [](const Disconnected& d) { std::cerr << "Error: " << d.reason; }
    }, state);
}
```

3. ç±»å‹è½¬æ¢

```
std::variant<int, double, std::string> v = 42;

std::string str = std::visit(overloaded {
    [](int i) { return std::to_string(i); },
    [](double d) { return std::to_string(d); },
    [](const std::string& s) { return s; }
}, v);
```
Cè¯­è¨€å¯ä»¥ç”¨ unionåšç±»å‹è½¬æ¢ï¼Œåœ¨C++ä¸­å±äºæœªå®šä¹‰è¡Œä¸ºã€‚

ç°ä»£ C++æ”¯æŒ `std::bit_cast` è¿›è¡Œå®‰å…¨çš„ä½è½¬æ¢ï¼Œmemcpyã€‚

4. é™æ€å¤šæ€ï¼Œé¿å…æ˜‚è´µçš„â€œç»§æ‰¿+è™šå‡½æ•°â€çš„å¼€é”€ã€‚

å¦‚æœä½ æœ‰ä¸€ç»„ç±»å‹ï¼ˆå¦‚åœ†ã€æ–¹ã€é•¿æ–¹å½¢ï¼‰ï¼Œè™½ç„¶å®ƒä»¬æœ‰å…±åŒè¡Œä¸ºï¼Œä½†ä½ ä¸æƒ³ä½¿ç”¨åŠ¨æ€å†…å­˜åˆ†é…ï¼ˆnewï¼‰å’Œè™šå‡½æ•°è¡¨ï¼ˆvtableï¼‰å¸¦æ¥çš„å¼€é”€ï¼Œvariant æ˜¯å®ç°é™æ€å¤šæ€çš„åˆ©å™¨ã€‚

å¯¹æ¯”ï¼š è™šå‡½æ•°éœ€è¦é€šè¿‡æŒ‡é’ˆè°ƒç”¨ï¼Œå¯èƒ½æœ‰ç¼“å­˜ç¼ºå¤±ï¼ˆCache Missï¼‰ï¼›variant å­˜å‚¨åœ¨`è¿ç»­å†…å­˜`ä¸­ï¼Œé…åˆ std::visit æ€§èƒ½æé«˜ã€‚

```cpp
struct Circle { double radius; };
struct Square { double side; };

using Shape = std::variant<Circle, Square>;

double get_area(const Shape& s) {
    return std::visit(overloaded {
        [](const Circle& c) { return 3.14 * c.radius * c.radius; },
        [](const Square& q) { return q.side * q.side; }
    }, s);
}
```

4. è§£æå¼‚æ„æ•°æ®(å¦‚ JSON/é…ç½®æ–‡ä»¶)

åœ¨å¤„ç† JSON æ—¶ï¼Œä¸€ä¸ªå­—æ®µçš„å€¼å¯èƒ½æ˜¯ `int`ã€`string`ã€`bool` æˆ– `double`ã€‚variant æ˜¯æè¿°è¿™ç§â€œä¸ç¡®å®šä½†æœ‰é™â€ç±»å‹çš„å®Œç¾é€‰æ‹©ã€‚

```cpp
using JsonValue = std::variant<std::nullptr_t, bool, int, double, std::string>;

// ä¸€ä¸ª key å¯¹åº”ä¸€ä¸ª JsonValue
std::map<std::string, JsonValue> config;   // å®šä¹‰ä¸€ä¸ªmapç±»å‹
config["port"] = 8080;
config["server"] = "localhost";
config["debug"] = true;
```

5. å¥å£®çš„é”™è¯¯å¤„ç† (æ›¿ä»£é”™è¯¯ç )

åœ¨å‡½æ•°å¯èƒ½è¿”å›ç»“æœä¹Ÿå¯èƒ½è¿”å›é”™è¯¯æ—¶ï¼Œä¼ ç»Ÿçš„åšæ³•æ˜¯è¿”å› `-1` æˆ–æŒ‡é’ˆï¼Œä½†è¿™å¾€å¾€ä¸ç›´è§‚ã€‚variant å¯ä»¥åƒå‡½æ•°å¼è¯­è¨€ï¼ˆå¦‚ Rust çš„ Resultï¼‰é‚£æ ·æ¸…æ™°åœ°è¡¨è¾¾ç»“æœã€‚

```cpp
struct Success { std::vector<uint8_t> data; };
struct Error { int code; std::string message; };

using FetchResult = std::variant<Success, Error>;

FetchResult download_data() {
    if (network_ok) return Success{...};
    else return Error{404, "Not Found"};
}
```

---

#### volatile

```cpp
int value = 10;

int test() {
    int a = value;
    int b = value;
    int c = value;
    return a + b + c;
}

```

æ—  volatile çš„æ±‡ç¼–ï¼ˆ-O2ï¼‰

```asm
test():
    mov  eax, DWORD PTR value[rip]   ; è¯»å–ä¸€æ¬¡
    lea  eax, [rax+rax*2]            ; eax = eax * 3ï¼ˆä¼˜åŒ–ï¼ï¼‰
    ret
```
ç¼–è¯‘å™¨ä¼˜åŒ–ï¼šåªè¯»å–å†…å­˜ä¸€æ¬¡, è®¡ç®— `value * 3`

æœ‰ volatile çš„æ±‡ç¼–

```asm
test():
    mov  eax, DWORD PTR value[rip]   ; è¯»å–ç¬¬ä¸€æ¬¡
    mov  edx, DWORD PTR value[rip]   ; è¯»å–ç¬¬äºŒæ¬¡
    add  eax, edx
    mov  edx, DWORD PTR value[rip]   ; è¯»å–ç¬¬ä¸‰æ¬¡
    add  eax, edx
    ret
```
volatile ä¸ä¿è¯åŸå­æ€§ï¼Œ ä¸ä¿è¯å†…å­˜é¡ºåºï¼Œä¸åŒæ­¥ç¼“å­˜ã€‚


---

## å…¶ä»–

### JSF++ æ ‡å‡†ä¸é˜²å¾¡å¼ç¼–ç¨‹

SF++ ç¼–ç æ ‡å‡†ï¼ˆå…¨ç§°ï¼šJoint Strike Fighter C++ Coding Standardsï¼‰æ˜¯ç›®å‰åµŒå…¥å¼ C++ é¢†åŸŸæœ€è‘—åã€æœ€ä¸¥è‹›çš„ç¼–ç è§„èŒƒä¹‹ä¸€ã€‚å®ƒæ˜¯ä¸“é—¨ä¸º F-35 é—ªç”µ II æˆ˜æ–—æœºï¼ˆJoint Strike Fighterï¼‰ é¡¹ç›®è®¾è®¡çš„ï¼Œç›®çš„æ˜¯ç¡®ä¿å…¶é«˜è¾¾æ•°ç™¾ä¸‡è¡Œçš„ä»»åŠ¡å…³é”®å‹ï¼ˆMission-Criticalï¼‰ä»£ç å…·æœ‰æé«˜çš„å®‰å…¨æ€§ã€å¯é æ€§å’Œå¯æµ‹è¯•æ€§ã€‚

JSF++ çš„æ ¸å¿ƒç†å¿µæ˜¯ï¼šå¦‚æœä¸€ä¸ªç‰¹æ€§å¯èƒ½å¯¼è‡´ä¸å¯é¢„æµ‹çš„è¡Œä¸ºï¼Œé‚£ä¹ˆç›´æ¥ç¦ç”¨å®ƒã€‚

åœ¨ F-35 è¿™ç§æœ€é«˜å®‰å…¨ç­‰çº§çš„èˆªç©ºèˆªå¤©é¡¹ç›®ä¸­ï¼ŒGreen Hills Software (GHS, [é“¾æ¥](https://www.ghs.com/products/compiler.html)) çš„ç¼–è¯‘å™¨æ˜¯è¡Œä¸šæ ‡å‡†ã€‚DDC-Iï¼šè¿™æ˜¯å¦ä¸€ä¸ªåœ¨èˆªå¤©é¢†åŸŸéå¸¸è‘—åçš„ç¼–è¯‘å™¨ä¾›åº”å•†ï¼Œä¸“é—¨æä¾›æ»¡è¶³å®æ—¶æ€§è¦æ±‚çš„ C++ å·¥å…·é“¾ã€‚Stroustrup åœ¨ 2005 å¹´è®ºæ–‡ä¸­æåˆ°çš„ï¼Œç¡¬å®æ—¶ç³»ç»Ÿéœ€è¦é¢„æµ‹æ¯ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚

- ç¦ç”¨åŠ¨æ€å†…å­˜åˆ†é… (No Heap)ã€‚åŠ¨æ€åˆ†é…ä¼šå¯¼è‡´å†…å­˜ç¢ç‰‡åŒ–å’Œæ‰§è¡Œæ—¶é—´ä¸ç¡®å®šã€‚åœ¨æˆ˜æ–—æœºé£è¡Œä¸­ï¼Œç³»ç»Ÿç»ä¸èƒ½å› ä¸ºâ€œå†…å­˜åƒåœ¾å›æ”¶â€æˆ–â€œç”³è¯·ä¸åˆ°ç©ºé—´â€è€Œå¡é¡¿ã€‚
- å¼‚å¸¸å¤„ç†çš„é™åˆ¶ (No Exceptions)
- ç¦ç”¨è¿è¡Œæ—¶ç±»å‹è¯†åˆ« (No RTTI)
- ç¡®å®šæ€§çš„é€’å½’ (No Unbounded Recursion)
- ç¦æ­¢ goto
- å¼ºåˆ¶æ€§æ³¨é‡Šï¼šæ¯ä¸€æ®µä»£ç å¿…é¡»æœ‰å¯¹åº”çš„éœ€æ±‚ç¼–å·ï¼Œè¿™ç§å¯è¿½æº¯æ€§æ˜¯èˆªå¤©çº§å¼€å‘çš„é€šç”¨æ ‡å‡†ã€‚
- é™æ€åˆ†æï¼šJSF++ è¦æ±‚ä»£ç å¿…é¡»èƒ½é€šè¿‡é™æ€åˆ†æå·¥å…·ï¼ˆå¦‚ LDRA æˆ– PRQAï¼‰çš„è‡ªåŠ¨åŒ–æ£€æŸ¥ã€‚è¿™æ„å‘³ç€ä½ çš„ä»£ç ä¸ä»…è¦èƒ½è·‘ï¼Œè¿˜è¦é•¿å¾—â€œæ ‡å‡†â€ã€‚

JSF++ç¼–ç æ ‡å‡†ä¸¥æ ¼ç¦æ­¢åœ¨æˆ˜æ–—æœºåº”ç”¨ä¸­ä½¿ç”¨çš„ C++ä»£ç åº“ä¸­ä½¿ç”¨å¼‚å¸¸å’Œè‡ªç”±å­˜å‚¨ã€‚ç”±äºè‡ªç”±å­˜å‚¨çš„ä¸ç¡®å®šæ€§ï¼Œæ ‡å‡†åº“ std::string å’Œ std::vectorã€std::map ç­‰å®¹å™¨åº”è¯¥è¢«ç¦æ­¢ï¼Œå› ä¸ºè¿™äº›åŠŸèƒ½å†…éƒ¨ä½¿ç”¨ new å’Œ deleteï¼Œè¿™ä½¿å¾—å®ƒä»¬åŒæ ·ä¸å¯é¢„æµ‹ã€‚

SF++ åæ¥æ·±åˆ»å½±å“äº†åæ¥çš„ MISRA C++ æ ‡å‡†ï¼ˆæ±½è½¦è¡Œä¸šæ ‡å‡†ï¼‰å’Œ AUTOSARã€‚

## è¯»è®¡ç®—æœºç§‘å­¦çš„ç»å…¸

è¿‡å»ä¸€ç›´æœ‰ä¸€ä¸ªå£°éŸ³ï¼Œè®©æˆ‘ä»¬å»è¯»ç»å…¸ï¼Œè¯»ã€Šçº¢æ¥¼æ¢¦ã€‹ï¼Œ è¯»å·´å°”æ‰å…‹ï¼Œè¯»èå£«æ¯”äºšï¼Œè¯»ã€Šè·é©¬å²è¯—ã€‹ï¼Œè¯»ã€Šè®ºè¯­ã€‹... **ä¸ºä»€ä¹ˆè¦è¯»ç»å…¸**? 

å› ä¸ºçœŸæ­£çš„ç¾ï¼Œä»å¤è‡³ä»Šéƒ½æ²¡æœ‰æ”¹å˜ï¼Œæ”¹å˜çš„åªæ˜¯å®ƒè¡¨è¾¾ç¾çš„å½¢å¼å’Œè¡¨ç°æ–¹å¼ã€‚å°±å¦‚,å³ä¾¿å‡ åƒå¹´è¿‡å»äº†ï¼Œæˆ‘ä»¬ä»ç„¶ä¼šè§‰å¾—ä¸‡é‡Œé•¿åŸå¾ˆç¾ï¼Œç§¦å…µé©¬ä¿‘å¾ˆç¾ï¼Œ æ¯”è¨æ–œå¡”å¾ˆç¾ï¼Œè’™å¨œä¸½èå¾ˆç¾ï¼Œæ¢µé«˜çš„å‘æ—¥è‘µå¾ˆç¾...ç¾çš„äº‹ç‰©ï¼Œäººä»¬å¾ˆå®¹æ˜“å¾—åˆ°å…±è¯†ã€‚

æˆ‘æŠŠè¿™æ ·çš„æƒ³æ³•ä¹Ÿæ”¾åœ¨äº†ç¼–ç¨‹é¢†åŸŸï¼Œæˆ‘ä»¬è¯¥å»è¯»è®¡ç®—æœºç§‘å­¦çš„ç»å…¸ã€‚è¯»è®¡ç®—æœºç§‘å­¦åœ¨æ—©å…ˆåˆ›å»ºçš„æ—¶å€™ï¼Œé‚£äº›å…ˆé©±è€…çš„æ€æƒ³ï¼Œä»¥åŠåæ¥ä¸æ–­å‡ºç°çš„ç»å…¸ã€‚

ä¸ºä»€ä¹ˆè¦åšè¿™ä»¶äº‹æƒ…ï¼Ÿå› ä¸ºä¸€æ–¹é¢è®¡ç®—æœºçš„æŠ€æœ¯è¶Šæ¥è¶Šçº·ç¹å’Œå­¦ç§‘ç»†åŒ–ï¼›å¦ä¸€æ–¹é¢ï¼Œè¶Šæ¥è¶Šå¤šçš„äººç—´è¿·äºç§‘å­¦æŠ€æœ¯äº§ç”Ÿçš„å·¥å…·ï¼Œç”šè‡³æœ‰äº›äººç—´è¿·äºä¸€ç§ç¼–ç¨‹è¯­è¨€ã€‚æ­£å¦‚Bjarne Stroustrupåœ¨[è®¿è°ˆ](https://www.youtube.com/watch?v=NvWTnIoQZj4)ä¸­æåˆ°ï¼š

> â€Nobody should call themselves a professional if they only knew one language.ï¼ˆæ²¡æœ‰äººåº”è¯¥æŠŠè‡ªå·±è§†ä¸ºä¸€ä¸ªä¸“å®¶ï¼Œå¦‚æœä»–ä»¬åªçŸ¥é“ä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼‰â€œ

ç”±æ­¤ï¼Œæ–°ä¸€ä»£çš„äººä»¬å¼€å§‹å¿½ç•¥äº†è®¡ç®—æœºç§‘å­¦çš„æœ¬è´¨ï¼Œå¿˜æ‰äº†é‚£äº›ç®€å•è€Œæœ´ç´ çš„çœŸç†ã€‚**åªæœ‰å»è¯»ç»å…¸ï¼Œæ‰èƒ½ä»è¿™è¶Šæ¥å¤æ‚å’Œåºå¤§çš„å­¦ç§‘ä¸­ï¼ŒæŠŠæ¡å®ƒæœ€ç¾ã€æœ€ç²¾åçš„æ€æƒ³**ã€‚

æˆ‘æ‰“ç®—èŠ±ä¸¤å¹´çš„æ—¶é—´ï¼ŒæŠŠè¿™äº›ç»å…¸çš„è®ºæ–‡å’Œä¹¦ç±çœ‹ä¸€éï¼Œæˆ‘è¦å›åˆ°é‚£ä¸ªç®€å•æœ´ç´ çš„æ€æƒ³èµ·ç‚¹ã€‚

### ä¸€äº›è®ºæ–‡
[CSCI E-192](https://canvas.harvard.edu/courses/34992/assignments/syllabus) è¯¾ç¨‹æä¾›äº†å¾ˆå¥½çš„å‚è€ƒï¼Œä»–ä»¬åˆ—å‡ºçš„Paperä¸»è¦åœ¨è¿™é‡Œï¼š[master list.](https://canvas.harvard.edu/courses/34992/assignments/syllabus)

æˆ‘è§‰å¾—å…¶ä¸­æ¯ä¸€ç¯‡çš„éƒ½å€¼å¾—ä¸€è¯»ï¼Œæ‰€ä»¥å°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ã€‚å®åœ¨ä¸å–œæ¬¢çš„å¯ä»¥ç•¥è¯»ï¼Œä½†æ˜¯ä¹Ÿè¯¥èƒ½æŠŠæ¡å®ƒçš„æ€æƒ³ã€‚

### ä¸€äº›ä¹¦å•

æ¥è‡ªRedditï¼Œæ›´å¤šçš„è®¨è®ºåœ¨é“¾æ¥è¿™é‡Œ: [Is there a list of the canonical introductory textbooks covering the major branches of computer science? ](https://np.reddit.com/r/compsci/comments/gprp0/is_there_a_list_of_the_canonical_introductory/c1pcqe5/)  
æˆ‘åªå…³å¿ƒæˆ‘å¯¹å…¶ä¸­æ„Ÿå…´è¶£çš„ä¹¦ï¼Œäººçš„ä¸€ç”Ÿæ—¶é—´æœ‰é™ï¼Œæˆ‘ä¸å¯ä»¥ä»€ä¹ˆä¹¦éƒ½å»è¯»ã€‚ä¸ç®¡å®ƒå†™çš„å†å¥½ï¼Œå¦‚æœæˆ‘å¯¹å…¶ä¸æ„Ÿå…´è¶£ä¹Ÿæ˜¯å¾’åŠ³ã€‚

- **SICP** (Structure and Interpretation of Computer Programs (Abelson & Sussman))
- Formal Language: A Practical Introduction by Webber
- Abstract and Concrete Categories: The Joy of Cats by Adamek et al
- Fundamentals of Computer Graphics by Shirley and Marschner
- Distributed Systems: Concepts and Design by Dollimore et al
- **Introduction to Functional Programming using Haskell **by Bird and Wadler
- **ML for the Working Programmer by Paulson**
- **How to Design Programs**ï¼ˆFelleisenç­‰äººï¼‰
-  **Concepts, Techniques, and Models of Computer Programming **(Van Roy & Haridi

#### å…³äºç¼–è¯‘å™¨

Redditä¸Šæœ‰å…³äºè®¨è®ºç¼–è¯‘å™¨ä¹¦å•çš„ä¸€ä¸ªè¯é¢˜ï¼Œ[Recommendations for books on compilers](https://www.reddit.com/r/programming/comments/3tgryd/recommendations_for_books_on_compilers/)ã€‚å…¶ä¸­sanxiynè¯„è®ºåˆ°ï¼š
GCC wiki recommends [a list of compiler books](https://gcc.gnu.org/wiki/ListOfCompilerBooks).

æ‰“å¼€ä¹‹åï¼Œæˆ‘åªé€‰äº†ä¸€æœ¬ï¼š **Appel. Modern Compiler implementation in ML**


å…³äºç¼–è¯‘å™¨ä¹¦ç±çš„è¯„è®ºï¼Œæˆ‘æƒ³ Vladimir N. Makarovçš„è¯è¯­ä¸ºæˆ‘æŒ‡æ˜äº†å­¦ä¹ å’Œé˜…è¯»çš„æ–¹å‘ï¼š
> If you don't want to be compiler savvy but want to understand the compiler, I'd recommend Appel's, Cooper's, Morgan's book in the same priority.

æˆ‘ç°åœ¨è¿˜ä¸æ¸…æ¥šè‡ªå·±æƒ³ä¸æƒ³ç²¾é€šç¼–è¯‘å™¨ï¼Œæ‰€ä»¥å…ˆè¯»è¿™äº›åŸºç¡€çš„ä¹¦ï¼Œå¦‚æœå…´è¶£è¶Šå¤šå°±è¯»æ›´å¤šã€‚


## ç¼–ç¨‹ç¢ç¢å¿µ




### æ¨ç‰¹çš„å¼€æºç®—æ³•

æ¨ç‰¹å¼€æºäº†ä»–ä»¬çš„ç®—æ³•ï¼Œhttps://github.com/xai-org/x-algorithm ã€‚

1. thunderç­›é€‰å…³æ³¨è´¦æˆ·çš„å¸–å­ï¼Œæ”¾åœ¨å†…å­˜ã€‚phoenixä»æ‰€æœ‰çš„å¸–å­ä¸­æ£€ç´¢ä¸ç”¨æˆ·å‘é‡æœ€ç›¸ä¼¼çš„1åƒæ¡å¸–å­ã€‚è¯¥ä¸¤ä¸ªæ•°æ®æºæ„æˆå€™é€‰çš„å¸–å­ï¼Œé‡‡ç”¨å¼‚æ­¥è·å–ã€‚
2. å¯¹å€™é€‰çš„å¸–æ·»åŠ è¡¥å……ä¿¡æ¯ã€‚
3. é¢„è¿‡æ»¤å™¨ï¼šç§»é™¤é‡å¤çš„ï¼Œå±è”½çš„å¸–å­ç­‰ã€‚
4. æ‰“åˆ†å’Œæ’åºï¼Œä½œè€…å¤šæ ·æ€§æ‰“åˆ†å™¨ã€‚
5. æŒ‰è¯„åˆ†é«˜ä½ç­›é€‰å‰50æ¡ã€‚
6. æœ€ç»ˆè¿‡æ»¤ï¼šç§»é™¤å·²åˆ é™¤æˆ–åƒåœ¾å¸–å­ç­‰ã€‚  

è¿™ä¸ªç®—æ³•æœ€æ ¸å¿ƒçš„éƒ¨åˆ†æœ‰ä¸¤ä¸ªï¼š

- ä¸€æ˜¯ç­›é€‰é˜¶æ®µphoenixçš„ç›¸ä¼¼åº¦è®¡ç®—ï¼Œç”¨æˆ·å‘é‡Â·å¸–å­å‘é‡çš„ç‚¹ç§¯è¿ç®—ï¼›
- äºŒæ˜¯å¯¹å¸–å­çš„ç²¾ç»†æ‰“åˆ†ï¼Œä»ç”¨æˆ·ç‚¹èµã€è¯„è®ºã€è½¬å‘ã€ç‚¹å‡»å’Œä¸¾æŠ¥ç­‰ç»´åº¦åŠ æƒæ‰“åˆ†ï¼Œè®¡ç®—æ¯ä¸ªå¸–å­çš„è¯„åˆ†ã€‚

æŠ€æœ¯ç»†èŠ‚ï¼šå¦‚æœä¸ºæ¯ä¸ªç”¨æˆ·ä¿å­˜1024å‘é‡ï¼Œå…¨çƒ10äº¿ç”¨æˆ·åˆ™éœ€è¦4TBã€‚ä¸ºèŠ‚çº¦å­˜å‚¨ç©ºé—´ï¼Œå°†1024åˆ†æˆå››ç»„256ç»´å‘é‡ï¼Œæ¯ç»„ç”¨ä¸€ä¸ªç‹¬ç«‹çš„å“ˆå¸Œå‡½æ•°ã€‚å“²å­¦æ„ä¹‰ä¸Šï¼Œå¯ä»¥ç†è§£ä¸ºæ¯ä¸ªç”¨æˆ·è¢«å‹ç¼©æˆæŠ½è±¡çš„4ç»„ç‰¹å¾ï¼Œæ¯ä¸ªç‰¹å¾æœ‰10ä¸‡ç§ä¸åŒï¼ˆå“ˆå¸Œè¡¨çš„æ¡æ•°ï¼‰ã€‚


è¯¥ç®—æ³•æ˜¾ç„¶çš„å¼Šç«¯ä¼šå¯¼è‡´ä¿¡æ¯æ”¶æ•›ï¼Œå› ä¸ºæ•°æ®æºæ¥è‡ªå…³æ³¨åˆ—è¡¨å’ŒMLæ‰“åˆ†å‡ºæ¥ç›¸å…³åº¦é«˜çš„å¸–å­ã€‚æœ€ç»ˆæ¨èç»™ç”¨æˆ·çš„å†…å®¹ï¼Œå…¶ä¸­å°±åªå‰©ä¸‹ç”¨æˆ·æƒ³çœ‹çš„å†…å®¹ï¼Œä¿¡æ¯èŒ§æˆ¿æˆ–è€…è¯´æ”¶æ•›ã€‚åº”å½“åŠ å…¥ä¸€äº›çƒ­é—¨æˆ–éšæœºçš„ä¸œè¥¿ï¼Œè®©ä¿¡æ¯å‘æ•£ã€‚



### zendeskæœåŠ¡

è¿™ä¸ªæœåŠ¡å¾ˆæœ‰æ„æ€ï¼Œè‡´åŠ›äºç®€åŒ–å®¢æˆ·å’Œå…¬å¸ä¹‹é—´çš„å®¢æˆ·è§£å†³æ–¹æ¡ˆã€‚è¿™æ˜¯ä¸€ä¸ªåœ¨ç»†åˆ†é¢†åŸŸæˆåŠŸåˆ›ä¸šçš„æƒ³æ³•ï¼Œç‰¹åˆ«æ£’çš„ideaã€‚åœ¨æœªæ¥å½“äº’è”ç½‘çš„åŸºç¡€è®¾ç½®è¢«å·¨å¤´å„æ–­æ—¶ï¼Œåˆåˆ›å…¬å¸æƒ³è¦åœ¨äº’è”ç½‘åˆ†ä¸€æ¯ç¾¹ï¼Œä»–ä»¬å°±è¦ä»ç»†åˆ†é¢†åŸŸç€çœ¼ã€‚è®¤çœŸè€ƒè™‘ç”¨æˆ·çš„éœ€æ±‚ï¼Œè€ƒè™‘å…¬å¸çš„éœ€æ±‚ï¼Œå°¤å…¶è¿™ç§çœ‹èµ·æ¥æ¯«ä¸èµ·çœ¼çš„ã€‚

### å¯¹è½¯ä»¶æ›´æ–°è¿‡å¿«çš„æŠ±æ€¨

æˆ‘çš„ä¸€äº›è½¯ä»¶æ€»æ˜¯é¢‘ç¹æç¤ºæ›´æ–°ï¼Œè¿™ä¹ˆå¤šå¼€å‘è€…å’Œä¼ä¸šçƒ­è¡·äºå¿«é€Ÿè¿­ä»£æ›´æ–°ã€‚è®©æˆ‘æ„Ÿåˆ°åŒæ¶ã€‚æœ€å¥½çš„è½¯ä»¶åº”è¯¥åªå‘å¸ƒä¸€æ¬¡ï¼Œå¹¶ä¸”æœ€å¥½æ°¸è¿œä¸å†æ›´æ–°ã€‚æˆ‘å¯¹é‚£äº›æ–°åŠŸèƒ½å’Œç‰¹æ€§å®Œå…¨æ²¡æœ‰æ„Ÿå…´è¶£ï¼Œæˆ‘åªæ˜¯éœ€è¦ä¸€ä¸ªè¶³å¤Ÿç¨³å®šçš„ç‰ˆæœ¬ï¼Œæ²¡æœ‰bugï¼Œè¾…åŠ©å®Œæˆæˆ‘çš„å·¥ä½œã€‚æˆ‘ç›¸ä¿¡80%çš„ç”¨æˆ·åªç”¨äº†è½¯ä»¶20%çš„åŠŸèƒ½ï¼Œç„¶è€Œï¼Œ80%çš„åŠŸèƒ½ç‰¹æ€§ä¸åˆ°20%çš„ç”¨æˆ·åœ¨ä½¿ç”¨ã€‚

ä¸ºä»€ä¹ˆè¦è¯•å›¾å›Šæ‹¬æ‰€æœ‰çš„éœ€æ±‚å‘¢ï¼Ÿæˆ‘èƒ½ç†è§£è¿™èƒŒåçš„åŸå› ï¼šå¼€å‘è€…å’Œäº§å“ç»ç†æ‹¿äº†è–ªæ°´ï¼Œä»–ä»¬æ€»æ˜¯åœ¨ä¸åœå¯»æ‰¾æ–°çš„ç‰¹æ€§åŠ å…¥ï¼Œä»¥è¯æ˜è‡ªå·±çš„å·¥ä½œä»·å€¼ä»¥å…è¢«ç‚’é±¿é±¼ï¼Œè€æ¿ä¹Ÿå¾ˆä¹æ„è‡ªå·±çš„è½¯ä»¶åœ¨å˜å¾—å¼ºå¤§ã€‚ç„¶è€Œï¼Œç”¨æˆ·çœŸçš„éœ€è¦é‚£äº›æ–°ç‰¹æ€§å—ï¼Ÿè¿™æ˜¯ä¸€ä¸ªå€¼å¾—ä»–ä»¬åœä¸‹æ¥å»æ€è€ƒçš„é—®é¢˜ã€‚èµ·ç æˆ‘å¸Œæœ›è‡ªå·±çš„è¿™äº›è½¯ä»¶å¯ä»¥åœæ­¢æ›´æ–°ã€‚æˆ–è€…æä¾›ä¸¤ä¸ªä¸åŒæ›´æ–°é¢‘ç‡çš„ç‰ˆæœ¬ï¼šä½æ›´æ–°é¢‘ç‡çš„ã€Œç¨³å®šç‰ˆã€å’Œé«˜é¢‘ç‡æ›´æ–°çš„ã€Œå¼€å‘ç‰ˆã€ï¼Œæ¥æ»¡è¶³ä¸¤ç§é£æ ¼ä¸åŒçš„ç”¨æˆ·ã€‚

2022-01-02

---

### å…³äºæˆ‘çš„å…´è¶£

**åˆ°ç°åœ¨æˆ‘è¿˜ä¸çŸ¥é“æˆ‘çš„å…´è¶£èšç„¦äºå“ªä¸ªç‚¹ï¼Œæ‰€ä»¥æˆ‘å°½å¯èƒ½äº†è§£æ›´å¤šï¼Œå­¦ä¹ æ›´å¤š**ã€‚ä¸è¿‡æˆ‘çŸ¥é“æˆ‘å–œæ¬¢ç¼–ç¨‹è¯­è¨€ä¸­æœ‰æ„æ€çš„æ¦‚å¿µï¼Œæœ‰æ„æ€çš„æƒ³æ³•ã€‚**æˆ‘æƒ³æˆ‘çš„å¥½å¥‡å¿ƒä¼šå¸®åŠ©æˆ‘æ‰¾åˆ°æœ€ç»ˆçš„ç­”æ¡ˆï¼Œè®©æˆ‘çš„å·¥ä½œæœ‰ä¸€ä¸ªæ ¸å¿ƒçš„å…³æ³¨ç‚¹ã€‚**

æˆ‘å¯¹äºè®¡ç®—æœºä¸­ä¸€äº›ä¸ªäººå£å‘³çš„ä¸å–œæ¬¢æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œæ¯”å¦‚ï¼šè®¡ç®—æœºå›¾å½¢å­¦ï¼Œå¯†ç å­¦ï¼Œæˆ‘å¯¹è¿™äº›åŸºæœ¬ä¸Šæ²¡æœ‰å…´è¶£ã€‚æˆ‘åœ¨ä»å‰å·¥ä½œäº†è§£è¿‡å…³äºRSAå¯†é’¥çš„ç®—æ³•ï¼Œåªæ˜¯ä¸ºäº†æ»¡è¶³è€æ¿çš„å•†ä¸šéœ€è¦è¿›è¡Œå­¦ä¹ çš„ã€‚æ¯”å¦‚æˆ‘å¯¹LSMçš„æ•°æ®ç»“æ„æœ‰å…´è¶£ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—è‡ªå·±**å…³æ³¨çš„æ–¹å‘è¿˜æ˜¯ç¼–ç¨‹è¯­è¨€æ–¹å‘ï¼Œå…³å¿ƒæ•°æ®ç»“æ„å’Œç®—æ³•**ã€‚æˆ‘å¯¹Knuthçš„CWEBç¼–ç¨‹è¯­è¨€å¾ˆæ„Ÿå…´è¶£ï¼Œå®ƒå°†æ˜¯æˆ‘è¿™æ®µæ—¶é—´å¿™å®Œä¹‹åç¬¬ä¸€ä»¶äº‹æƒ…ã€‚

### å…³äºç¼–ç¨‹è¯­è¨€å·¥ç¨‹å®è·µçš„ä¹¦

æˆ‘ä¸å¤ªå–œæ¬¢çœ‹è¿™ç±»ä¹¦ï¼Œæ¯”å¦‚ä¸€äº›äººæ¨èã€Šä»£ç å¤§å…¨ã€‹ï¼Œé‡æ„è¿™ç±»çš„ä¹¦ã€‚å› ä¸ºæ­£å¦‚æˆ‘å‰é¢æ‰€è¯´çš„è§‚å¿µï¼š **ç¾æ˜¯ä¸€ç§å…±è¯†**ã€‚

åªè¦è¿½æ±‚ç¾ï¼Œæœ€ç»ˆå°±ä¼šå¤Ÿæ®Šé€”åŒå½’ã€‚å¦‚æœå¹´è½»æ—¶ä»£ç å†™çš„ä¸å¤Ÿç¾ï¼Œåªæ˜¯å› ä¸ºå¯¹ç¾çš„ç†è§£ä¸å¤Ÿæ·±åˆ»ï¼Œåªè¦ä¿æŒè¿™ç§è¿½æ±‚ï¼Œæœ€ç»ˆå°±ä¼šè‡ªå·±ç‹¬ç«‹çš„æ‰¾åˆ°ã€‚å¦‚æœä½ è§‰å¾—èƒ½æ‰¾åˆ°ä¸€ç§å’Œä¸€äº›æ–¹æ³•å°±èƒ½å¤Ÿå†™å‡ºç¾çš„ä»£ç ï¼Œæˆ‘è§‰å¾—è¿™æ˜¯è¯¯è§£å’Œæƒ³å½“ç„¶ã€‚åªè¦æœ‰äº†è‡ªå·±å¯¹ç¾çš„ç†è§£ï¼Œè‡ªç„¶å°±èƒ½åšå‡ºç¾çš„ä¸œè¥¿ï¼Œè€Œä¸éœ€è¦ä»»ä½•ä¸“æ³¨æ‰€è°“çš„â€æŠ€å·§â€œã€‚æœ‰ä¸ªè¯è¯­å«â€æ´—å¿ƒé©é¢â€œï¼Œåªè¦â€æ´—äº†å¿ƒâ€œï¼Œäººçš„é¢è²Œè‡ªç„¶å°±æ–°äº†ï¼Œè€Œä¸éœ€è¦â€é©é¢â€œã€‚ä¸èƒ½åšè¡¨é¢å·¥ä½œä¾§é‡å½¢å¼ï¼Œè€Œæ˜¯ä¸“æ³¨äºå†…åœ¨ã€‚


### ä¸€ä¸ªäººåº”è¯¥å­¦ä¹ å‡ é—¨ç¼–ç¨‹è¯­è¨€?

Bjarne Stroustrup(Interview): 
 
 First of all, **nobody should call themselves a professional if they only knew one language.**â€ **And five is a good number of languages to know reasonably well**. And then youâ€™ll know a bunch, just because youâ€™re interested, because youâ€™ve read about them, because youâ€™ve written a couple of little programs. But five isnâ€™t a bad number. Some of them books between three and seven. Letâ€™s see, well my list is going to be sort of uninteresting because itâ€™s going to be the list of languages that are best known and useful, Iâ€™m afraid. Letâ€™s see, C++,of course; Java; maybe Python for mainline work. And if you know those, you canâ€™t help knowing sort of a little bit about Ruby and JavaScript, you canâ€™t help knowing C because thatâ€™s what fills out the domain and of course C#. But again, these languages create a cluster so that if you knew either five of the ones that I said, you would actually know the others. I havenâ€™t cheated with the numbers. I rounded out a design space. It would be nice beyond that to know something quite weird outside it just to have an experience, pick one of the functional languages, for instance, thatâ€™s good to keep your head spinning a bit when it needs to. I donâ€™t have any favorites in that field. Thereâ€™s enough of them. And, I donâ€™t know, if youâ€™re interested in high-performance numerical computation, you have to look at one of the languages there, but for most people thatâ€™s just esoteric.
 
 Peter Norvig:   
 
 **Learn at least a half dozen programming languages**. Include one language that emphasizes class abstractions (like Java or C++), one that emphasizes functional abstraction (like Lisp or ML or Haskell), one that supports syntactic abstraction (like Lisp), one that supports declarative specifications (like Prolog or C++ templates), and one that emphasizes parallelism (like Clojure or Go).
 
 ä¸€é—¨ç¼–ç¨‹è¯­è¨€å°±åªæ˜¯ä¸€é—¨ç¼–ç¨‹è¯­è¨€ã€‚å®ƒå’Œä½ æ˜¯ä¸æ˜¯ä¸€ä¸ªä¼˜ç§€çš„ç¨‹åºå‘˜æ²¡æœ‰å…³ç³»ï¼Œå®ƒåªæ˜¯è¯­æ³•ã€‚

---

### è¯„è®ºè‹±ç‰¹å°”çš„ControlFlagå¼€æºåº“ï¼Œä»¥åŠAIã€‚

[AI å¸®ä»£ç æ‰¾ Bugï¼Œè‹±ç‰¹å°”å¼€æºæœºå™¨ç¼–ç¨‹å·¥å…· ControlFlag](https://m.ithome.com/html/582002.htm)

å¦‚æœä¸€ä¸ªç¨‹åºå‘˜å¯¹è‡ªå·±å†™çš„ä»£ç éƒ½æ²¡äº†è‡ªä¿¡ï¼Œè¿˜è¦æŒ‡æœ›AIæ‰¾å‡ºBugï¼Œè¿™å‡ ä¹æ˜¯ä¸€ç§æ™ºå•†ä¸Šçš„ç¾è¾±ã€‚è¦æ˜¯å •è½åˆ°è¿™ç§å¢ƒåœ°ï¼Œè¿˜å†™ä»€ä¹ˆä»£ç ï¼Œä¸å¦‚æ—©ç‚¹å›å®¶ç§åœ°ã€‚è¿™ä¸ªåº“åªæ˜¯è‹±ç‰¹å°”çš„å‘˜å·¥æ— èŠå¼€å‘å‡ºæ¥çš„å¨±ä¹ç©å…·ï¼Œå¦‚æœçœŸæœ‰ç¨‹åºå‘˜å½“äº†çœŸï¼Œé‚£å°±æœ‰ç‚¹å¯ç¬‘äº†ã€‚

äºŒåä¸€ä¸–çºªçš„è°è¨€ä¹‹ä¸€å°±æ˜¯AIã€‚äººè„‘ç»ä¸æ˜¯ä»»ä½•æœºå™¨ã€é›†æˆç”µè·¯å’Œç®—æ³•èƒ½æ¨¡æ‹Ÿå‡ºæ¥çš„ã€‚â€œäººå·¥â€æ°¸è¿œä¸ä¼šæœ‰â€œæ™ºèƒ½â€ï¼Œè¿™çº¯ç²¹æ˜¯ä¸€ä¸ªå“²å­¦é—®é¢˜ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæŠ€æœ¯é—®é¢˜ã€‚è¦çœŸæ˜¯åˆ°äº†å“ªå¤©ï¼Œæˆ‘ä»¬çš„ç¨‹åºéœ€è¦AIå»å†™ï¼Œæˆ‘ä»¬çš„ä¹¦ç±éœ€è¦AIåˆ›ä½œï¼Œæˆ‘ä»¬çš„ç”µå½±åŠ¨ç”»éœ€è¦AIå»è®¾è®¡ï¼Œé‚£ä¹ˆï¼Œäººç±»ç¦»ç­äº¡å°±ä¸è¿œäº†ã€‚

2021-10-22

---

### è¯„ç½‘é¡µè®¾è®¡

å¯¹äºç½‘é¡µè®¾è®¡ï¼Œæœ€å¥½çš„è®¾è®¡å°±æ˜¯æ²¡æœ‰å…¶å®ƒä»»ä½•æ— ç”¨çš„è®¾è®¡ã€‚

æ¯”å¦‚[cppreference.com](https://en.cppreference.com/w/cpp/language/modules) è¿™ä¸ªç½‘ç«™ï¼Œç®€æ´çš„æ’ç‰ˆï¼Œçªå‡ºä¸»è¦çš„åŠŸèƒ½ï¼Œå¹¿å‘Šä¹Ÿå¾ˆå°‘ã€‚ç±»ä¼¼çš„è¿˜æœ‰[filezilla](https://filezilla-project.org/)ã€‚è¿™äº›ç½‘é¡µçš„åŠŸèƒ½å…±åŒç‰¹ç‚¹æ˜¯ä¸€ç‚¹ä¹Ÿä¸èŠ±å“¨ï¼Œè¯¥æœ‰çš„åŠŸèƒ½å…¨éƒ½æœ‰ã€‚

ç°åœ¨çš„ç½‘ç«™å¤§éƒ½å„ç§èŠ±é‡Œèƒ¡å“¨çš„ï¼Œçœ‹èµ·æ¥ç‚«é…·ï¼Œå®é™…æ²¡æœ‰ä»€ä¹ˆå±ç”¨ã€‚ç”¨æˆ·éœ€è¦ä»ç½‘é¡µä¸Šè·å–æœ‰ç”¨çš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯è¢«é‚£äº›å¥‡æ€ªç‚«é…·çš„ä¸œè¥¿å¸å¼•æ³¨æ„åŠ›ã€‚æˆ‘ä¸çŸ¥é“äººä»¬æŠŠæ³¨æ„åŠ›æ”¾åœ¨è®©ç½‘ç«™å˜å¾—æ›´â€œç‚«é…·â€çš„æ„ä¹‰åœ¨å“ªé‡Œï¼Œå°±å¥½åƒé’æ˜¥æœŸçš„å°å±å­©å‰ªäº†ä¸ªâ€œçˆ†ç‚¸â€çš„å‘å‹ã€‚ä¸€åˆ‡æ¯«æ— æ„ä¹‰çš„äº¤äº’åŠ¨ä½œã€è¿‡åº¦çš„æ¸²æŸ“ï¼ŒUIè®¾è®¡ï¼Œæ— èŠçš„æ¨ªå¹…å’Œå›¾æ ‡ï¼Œå…¨æ˜¯ç‹—å±ã€‚

äººä»¬å°±åƒå–œé¹Šä¸€æ ·ï¼Œå–œæ¬¢é—ªäº®çš„ä¸œè¥¿ã€‚ä½†æ—¶é«¦çš„ä¸œè¥¿å¹¶ä¸ä¸€å®šæ˜¯æœ€å¥½çš„ã€‚redditæœ‰ä¸ªè¯„è®ºå†™åˆ°([é“¾æ¥](https://www.reddit.com/r/webdev/comments/1rdjri/comment/cdmhxtj/?utm_source=share&utm_medium=web2x&context=3)): â€œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¸‚åœºè¥é”€å¤©æ‰ï¼Œä»–æŠŠæ‰€æœ‰è¿™äº›æ„šè ¢çš„ä¸œè¥¿æ”¾åœ¨æˆ‘ä»¬çš„ç½‘ç«™ä¸Šï¼Œæˆ‘ä»¬çš„å®¢æˆ·ç¾¤æ‰©å¤§äº†ä¸€å€ã€‚æˆ‘ä¸æ˜ç™½ï¼Œä½†è¿™æ˜¯å•†äººå–œæ¬¢çš„â€ã€‚

2021-10-20

### è°ˆç§‘å­¦çš„é—¨æ§›

ç§‘å­¦çš„é—¨æ§›è¶Šæ¥è¶Šé«˜äº†ï¼Œä»¥ååªä¼šæ˜¯å°‘æ•°äººçš„ä¸“åˆ©ã€‚åœ¨é˜¿åŸºç±³å¾·æ—¶ä»£ï¼Œç‰›é¡¿æ—¶ä»£ï¼Œä½ æœ‰ä¸€åªç¬”ã€ä¸€äº›è‡ªåˆ¶çš„â€œç ´é“œçƒ‚é“â€ï¼Œæœ‰æ•é”çš„æ´å¯ŸåŠ›å’Œå¥½å¥‡å¿ƒï¼Œå°±èƒ½åšç§‘å­¦å®éªŒäº†ã€‚æ¯”å¦‚åƒå­Ÿå¾·å°”ï¼Œç§å‡ äº©è±Œè±†ä¹Ÿæ˜¯æ­£ç»çš„ç§‘å­¦ç ”ç©¶ã€‚

å¦‚ä»Šçš„ç§‘å­¦ï¼Œæ™®é€šäººè¦åšå®éªŒéœ€è¦å„ç§ä»ªå™¨ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„ç»è´¹å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚æ™®é€šäººï¼Œä¸ç§‘å­¦å¤§é™¢ä¸¤è€…ä¹‹é—´çš„å£å’åªä¼šè¶Šæ¥è¶Šåšï¼Œéšç€å­¦ç§‘å‘å±•ï¼Œç°ä»£äººæŒæ¡çš„çŸ¥è¯†è¦è¶Šæ¥è¶Šå¤šï¼Œè€Œå¯¹æœªæ¥äººç±»çš„å­¦ä¹ èƒ½åŠ›è¦æ±‚æ›´é«˜ã€‚æˆ‘ä»¬è¿˜èƒ½å›åˆ°è¿‡å»é‚£äº›ä¸éœ€è¦å­¦å†å°±èƒ½ä»äº‹ç§‘å­¦ç ”ç©¶çš„æ—¶ä»£å—ï¼Ÿææ€•å¾ˆéš¾ã€‚

è€Œè®¡ç®—æœºï¼Œæˆ‘è®¤ä¸ºå®ƒä»ç„¶æ˜¯ä¸€é—¨æ–°å…´çš„å­¦ç§‘ï¼Œå®ƒçš„å‘å±•å†å²ä¸åˆ°100å¹´ï¼Œä¾ç„¶æœ‰é•¿è¶³çš„æ½œåŠ›ã€‚æˆ‘ä¸çŸ¥é“ä»€ä¹ˆæ˜¯è®¡ç®—æœºæœªæ¥çœŸæ­£æ­£ç¡®çš„å‘å±•æ–¹å‘ï¼Œæˆ‘è¿˜åœ¨å¯»æ‰¾ã€‚æˆ‘å¸Œæœ›è‡ªå·±èµ°åœ¨æ­£ç¡®çš„æ–¹å‘ï¼Œæˆ‘å¸Œæœ›å°†è¿™é—¨ç§‘å­¦åœ¨å°†æ¥ä¼šæ›´åŠ å®Œå–„ï¼Œæ›´åŠ æœ‰è¶£ã€‚ä¹Ÿè®¸Donald Knuthä¼šæŒ‡å¼•æˆ‘ï¼Œå¸Œæœ›å¯ä»¥ä»ä»–çš„è‘—ä½œä¸­å¾—åˆ°ä¸€äº›ä»–çš„æ™ºæ…§ã€‚

2021-10-12

### è§£é‡Š<è–›å®šè°”çš„çŒ«>

è–›å®šè°”çš„çŒ«ï¼Œè¿™ä¸ªæ•…äº‹å…¶å®å·²ç»å¾ˆå½¢è±¡äº†ï¼Œä½†æ˜¯ä»æœ‰è®¸å¤šäººä¸èƒ½ç†è§£å®ƒæƒ³è¡¨è¾¾çš„å«ä¹‰ã€‚å®ƒæƒ³è¡¨è¾¾çš„æ˜¯æ€æƒ³æ˜¯ï¼šâ€œå•ä¸ªçš„å¾®è§‚äº‹ä»¶æ˜¯æ— æ³•é¢„æµ‹å’Œå‡†ç¡®æµ‹é‡çš„â€ã€‚

å‡å¦‚ä½ æ˜¯ä¸€ä¸ªå¾®è§‚ç²’å­ï¼Œé‚£ä¹ˆä½ æ­¤æ—¶åœ¨å®¶å¯èƒ½æ˜¯åœ¨ç¡è§‰ï¼Œæˆ–æ˜¯åœ¨ç©æ‰‹æœºï¼Œæˆ–ç”¨ç”µè„‘ï¼Œæˆ–è€…åœ¨æ´—æ‰‹é—´ä¸Šå•æ‰€ã€‚ä½†æ˜¯ä¸è®ºä½ åœ¨åšä»€ä¹ˆï¼Œæˆ‘éƒ½æ— æ³•çŸ¥é“ã€‚å¦‚æœæˆ‘æƒ³è¦çŸ¥é“ï¼Œæˆ‘å°±è¦é—¯å…¥ä½ çš„å±‹å­ï¼Œè§‚å¯Ÿä½ åœ¨åšä»€ä¹ˆã€‚é—®é¢˜æ˜¯ä¸€æ—¦æˆ‘é—¯å…¥ä½ å®¶å±‹å­ï¼Œå‡å¦‚ä½ åœ¨è¹²é©¬æ¡¶ï¼Œå¯èƒ½å°±ä¼šç«‹é©¬æèµ·è£¤å­äº†ï¼›å‡å¦‚ä½ åœ¨ç¡è§‰ï¼Œå°±å› æ­¤è¢«æˆ‘åµé†’äº†ã€‚ä½ ä¼šå› ä¸ºæˆ‘çš„è§‚æµ‹æ”¹å˜è‡ªå·±çš„è¡Œä¸ºï¼Œé‚£ä¹ˆå¯¼è‡´æˆ‘è§‚æµ‹çš„ç»“æœâ€œå¹¶ä¸å‡†ç¡®â€ã€‚

è¿™å°±æ˜¯è–›å®šè°”çš„çŒ«ï¼Œä½ æ°¸è¿œä¸çŸ¥é“é‚£åªçŒ«æ˜¯æ­»æ˜¯æ´»ï¼Œä¹Ÿä¸çŸ¥é“å®ƒåœ¨åšä»€ä¹ˆã€‚è¿™æ˜¯é‡å­ç†è®ºæœ€åŸºæœ¬çš„æ¦‚å¿µã€‚

2021-10-12

### è¯„è®ºRè¯­è¨€

Rè¯­è¨€çš„ç‰¹ç‚¹å¾ˆæ˜æ˜¾: æ•°æ®ç±»å‹è¶³å¤Ÿä¸°å¯Œï¼Œä½†æ•°æ®çš„æ“ä½œå¾ˆç¬¨ã€‚å¦‚åŒå»ä¸€å®¶é£Ÿç‰©ä¸°å¯Œçš„è‡ªåŠ©é¤å…ï¼Œä½†æ˜¯è€æ¿å´ä¸æä¾›åˆ€å‰ï¼Œåˆä¸ç»™ç›˜å­å’Œç«é”…ï¼Œåˆ°å¤´æ¥å…¨é æ‰‹æŠ“æ‰èƒ½åƒåˆ°å˜´é‡Œã€‚æ˜æ˜¾ä¸å¦‚åŒæ ·ä½œä¸ºè„šæœ¬è¯­è¨€å’Œå¯ç”¨äºç§‘å­¦è®¡ç®—çš„Pythonçµæ´»ã€‚

æ•°æ®çµæ´»ï¼Œä½†æ“ä½œä¸çµæ´»ï¼Œåœ¨æ‰§è¡ŒæŸäº›ä¸€è¿ä¸²æ“ä½œæ—¶å°±ä¼šè´¹åŠ²â€”â€”è€Œä¸å¾—ä¸æ±‚åŠ©ç¬¬ä¸‰æ–¹åŒ…ä»¥å¿«é€Ÿè§£å†³é—®é¢˜ã€‚è¿™æ˜¯ä¸€é—¨çœ‹èµ·æ¥ç®€å•çš„è¯­è¨€ï¼Œä½†æ˜¯éšè—çš„å‘å¤šï¼Œéœ€è¦ä¸€äº›ç»ƒä¹ å’ŒæŠ€å·§ä»¥åæ‰èƒ½å¾—å¿ƒåº”æ‰‹ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒPythonçœ‹èµ·æ¥ç®€å•ï¼Œç”¨èµ·æ¥ä¹Ÿç®€å•ã€‚

2021-10-11

### Window æ—¶é’Ÿä¸­æ–­   <a name="20211007WinIF"></a>

[microsoft: Interrupt Time](https://docs.microsoft.com/en-us/windows/win32/sysinfo/interrupt-time)ä¸­æ–­æ—¶é—´ä»…100çº³ç§’ï¼Œè¿™ä¸ªåº”è¯¥ä¸æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦çš„Timer Interruptsã€‚å› ä¸ºwindowsæ˜¯é—­æºçš„ï¼Œå› æ­¤æ— æ³•çŸ¥é“æ›´å¤šã€‚[è¿™é‡Œ](https://kb.vmware.com/s/article/1005802)æœ‰äººæåˆ°Windowæ˜¯64HZæˆ–100HZï¼Œé‚£ä¹ˆåº”è¯¥æ˜¯åˆç†çš„å€¼äº†ã€‚è€ŒLinuxç³»ç»Ÿé€šå¸¸æ˜¯250HZ(4ms)ï¼Œ[Philipçš„å›ç­”](https://unix.stackexchange.com/a/549912)æåˆ°äº†Jiffieså€¼å†å²ä¸Šå…ˆæ˜¯100HZ(10ms),åæ¥åˆæ”¹æˆäº†1000HZ(1ms)ã€‚

2021-10-07

### ç©¿å­”çº¸å¸¦å¾ˆé…·ï¼

[Programmers Deal With the Legacy of Paper Tape Every Day](https://medium.com/@pragdave/weird-programming-facts-1-3fe47d82a7fd)

1960 å¹´ä»£åˆæœŸï¼Œç¼–å†™è®¡ç®—æœºç¨‹åºçš„æ–¹å¼å¾ˆæœ‰æ„æ€ï¼Œä½¿ç”¨ç©¿å­”çº¸å¸¦æˆ–è€…ç©¿å­”å¡ç‰‡ã€‚ä»¥çº¸å¸¦ä¸ºä¾‹ï¼Œä¸Šé¢3å­”ä¸‹é¢5å­”ï¼Œå› ä¸ºå­”å‘ä¸€ä¾§åç§»å°±ä¸ä¼šå°ä¸å°å¿ƒè®©çº¸å¸¦å€’ç½®ã€‚çº¸å¸¦ä¸­é—´æœ‰é“¾è½®å­”ï¼Œç”¨äºå°†å®ƒæ‹‰è¿‡é˜…è¯»å™¨ã€‚æœ€ä¸‹é¢çš„å­”æ˜¯å¥‡å¶æ ¡éªŒä½ï¼Œå› æ­¤ä»å€’æ•°ç¬¬äºŒä½å¼€å§‹è¯»èµ·ã€‚æœ‰å­”çš„åœ°æ–¹è¯»ä¸º1ï¼Œæ²¡å­”çš„åœ°æ–¹è¯»ä¸º0ã€‚

é‚£ä¹ˆï¼Œå›¾ä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯è¯»ä½œ(1010100), å¯¹åº”è‹±æ–‡å­—ç¬¦Tã€‚ ç¬¬äºŒå­—ç¬¦è¯»ä½œï¼ˆ1101000)ï¼Œå¯¹åº”å­—ç¬¦hã€‚å¦‚æ­¤ï¼Œå°±æ˜¯ä¸€æ•´ä¸ªè‹±æ–‡â€œThis is PaperTaper \r\nâ€ã€‚å¯¹äº\r\nå­—ç¬¦çš„å‡ºç°ï¼Œå®ƒæ˜¯ä¸ºäº†æ ‡è¯†ä»£ç è¡Œçš„ç»“æŸã€‚å› ä¸ºç©¿å­”å¡ç‰‡ä¸€å¼ å¡ç‰‡å°±æ˜¯ä¸€è¡Œï¼Œè€Œç©¿å­”çº¸å¸¦æ˜¯è¿ç»­çš„ï¼Œå› æ­¤å®ƒè¦é‡‡ç”¨è¿™æ ·ç‰¹æ®Šæ–¹å¼æ ‡è®°ä¸€è¡Œç»“æŸã€‚70å¹´ä»£çš„Unixå¼€å‘è€…è®¤ä¸º\ræ˜¯å¤šä½™çš„ï¼Œå› æ­¤å¦‚ä»Šç»å¸¸åªç”¨\nä½œä¸ºç»“æŸã€‚

 åœ¨çº¸å¸¦ä¸Šè¾“å…¥å¤§é‡ç©ºæ ¼æ˜¯ä¸€ç§æµªè´¹ï¼Œå› æ­¤tabç¬¦å·å°±äº§ç”Ÿäº†ï¼Œå®ƒè¡¨ç¤ºå‘Šè¯‰çº¸å¸¦çš„é˜…è¯»æœºå™¨ç›´æ¥è·³åˆ°ä¸‹ä¸€åˆ—ç¼–å·ï¼ˆè·³è¿‡8ä¸ªå­—ç¬¦ï¼‰ã€‚å¦‚ä»Šç‰©ç†é”®ç›˜ä¸Šçš„Tabå·²ç»ä¸æ˜¯å½“åˆçš„å«ä¹‰äº†ï¼Œé€šå¸¸åªæ˜¯ç­‰åŒè¾“å…¥2æˆ–è€…4ä¸ªç©ºæ ¼ã€‚ æ¢é¡µç¬¦\få«ä¹‰æ˜¯è·³åˆ°ä¸‹ä¸€é¡µçš„é¡¶éƒ¨ï¼Œè€Œå‚ç›´åˆ¶è¡¨ç¬¦\vä¼šä½¿é¡µé¢å‘ä¸‹è·³åˆ°é¢„è®¾è¡Œåˆ—è¡¨ä¸­çš„ä¸‹ä¸€é¡µã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬é€šå¸¸å°†è¿™äº›å­—ç¬¦è§†ä¸ºç®€å•çš„ç©ºæ ¼ã€‚BEL å­—ç¬¦è®©æ‰“å­—æœºå†…æ•²å“ä¸ªé“ƒé“›ã€‚NUL å­—ç¬¦åˆ™æ˜¯å› ä¸ºçº¸å¸¦é€å…¥é˜…è¯»å™¨æ—¶ï¼Œå¾ˆéš¾å¯¹é½å®ƒï¼Œå‰ä¸€æ’æˆ–å‰ä¸¤æ’å¯èƒ½ä¼šæŸåï¼Œå› æ­¤å‰é¢çš„è§†ä¸ºç©ºç™½å­—ç¬¦NULã€‚DELå­—ç¬¦æ¯”è¾ƒå®ç”¨ï¼Œæ¯”å¦‚åœ¨çº¸å¸¦ä¸Šè¾“å…¥äº† 500 è¡Œä»£ç ï¼Œå°±åœ¨ä»£ç å³å°†å®Œæˆæ—¶æ‰“é”™äº†ä¸€ä¸ªå­—ç¬¦ã€‚æŠŠçº¸å¸¦å‰ªæ–­ä¸æ˜¯ä¸€ä¸ªå¥½åŠæ³•ï¼Œé‚£ä¹ˆç›´æ¥åœ¨ä¸‹ä¸ªå­”æ‰“æ»¡8ä¸ªå­”ï¼Œè¡¨ç¤ºé€»è¾‘ä¸Šåˆ é™¤å‰ä¸€ä¸ªå­—ç¬¦ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆDELå­—ç¬¦æ€»æ˜¯ASCIIç è¡¨çš„æœ€åä¸€ä¸ªï¼å®ƒåœ¨çº¸å¸¦å¾ˆæ˜æ˜¾ã€‚

2021-10-06

### è¿‡æ—©ä¼˜åŒ–ä¸æ€»æ˜¯ä¸‡æ¶ä¹‹æº

Donald Knuthåšå£«æ›¾è¯´è¿‡,"premature optimization is the root of all evil"(ç¿»è¯‘: è¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æº). è¿™å¥è¯æˆäº†å¾ˆå¤šç¨‹åºå‘˜å†™å‡ºç³Ÿç³•ä»£ç çš„å€Ÿå£, å¹¶ä¸”ä»–ä»¬ä»æ¥ä¸è¯•å›¾ä¼˜åŒ–è‡ªå·±çš„ä»£ç . ä½†æ˜¯Knuthåšå£«è¿™å¥è¯çš„ä¸‹åŠå¥å¾ˆå°‘æœ‰äººçŸ¥é“: " Yet we should not pass up our opportunities in that critical 3%"(è€Œå¯¹äºå½±å“æ€§èƒ½å…³é”®çš„ 3%ä»£ç ï¼Œæˆ‘ä»¬åˆ™ä¸èƒ½æ”¾å¼ƒä¼˜åŒ–çš„æœºä¼š). æˆ‘åœ¨å·¥ä½œä¸­å°±é‡åˆ°è¿‡è¿™æ ·çš„äº‹æƒ…, åœ¨å°è¯•ä¿®æ”¹å°‘é‡çš„æ ¸å¿ƒçš„ä»£ç , å…¶ç¨‹åºæ€§èƒ½æå‡1~3å€. å¦‚æœæ”¾å¼ƒè¿™æ ·çš„ä¼˜åŒ–æœºä¼š, å°†æ˜¯å¾ˆå¤§çš„æŸå¤±.


